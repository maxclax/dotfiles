 ;;; +templates.el -*- mode: emacs-lisp; lexical-binding: t; -*-

;;; Commentary:

(use-package! tempel
  :defer t
  :bind (("M-+" . tempel-complete)
         ("M-*" . tempel-insert))
  :init
  (setq tempel-path (expand-file-name "org/templates/*.el" {{ .managed_sync | quote }})))

(use-package tempel-collection)


(defun tempel--next-friday ()
  "Return timestamp of next Friday (today if Friday)."
  (let* ((now (decode-time))
         (dow (nth 6 now))  ; 0=Sun … 5=Fri … 6=Sat
         (days-ahead (if (= dow 5) 0 (- 12 dow))))
    (decoded-time-add now (make-decoded-time :day days-ahead))))

(defun tempel--last-day-of-month ()
  "Return timestamp of last day of current month (leap-year safe)."
  (let* ((now (decode-time))
         (y (nth 5 now))
         (m (nth 4 now))
         (day (pcase m
                ((or 1 3 5 7 8 10 12) 31)
                ((or 4 6 9 11) 30)
                (2 (if (and (= (mod y 4) 0)
                            (or (/= (mod y 100) 0) (= (mod y 400) 0)))
                       29 28)))))
    (encode-time 0 0 0 day m y)))

(defun tempel--last-day-of-quarter ()
  "Return timestamp of last day of current quarter."
  (let* ((now (decode-time))
         (m (nth 4 now))
         (y (nth 5 now))
         (end-m (cond ((<= m 3) 3) ((<= m 6) 6) ((<= m 9) 9) (t 12))))
    (encode-time 0 0 0 (if (= end-m 12) 31 30) end-m y)))

(provide 'init-templates)
