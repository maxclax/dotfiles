# -*- mode: nix; -*-
{ pkgs, ... }:

{
  # Ranger Configuration (file manager)
  programs.ranger = {
    enable = true;

    settings = {
      # Display settings
      show_hidden = true;
      preview_files = true;
      preview_directories = true;
      collapse_preview = false;
      draw_borders = "both";

      # UI improvements
      column_ratios = "1,3,4";
      hidden_filter = "^\\.|\\.(?:pyc|pyo|bak|swp)$|^lost\\+found$|^__(pycache)__$";
      show_cursor = false;
      wrap_scroll = true;

      # Performance
      preview_max_size = 0;
      use_preview_script = true;

      # Behavior
      automatically_count_files = true;
      open_all_images = true;
      vcs_aware = true;
      update_title = false;
      shorten_title = 3;

      # Sorting
      sort = "natural";
      sort_case_insensitive = true;
      sort_directories_first = true;
      sort_unicode = false;
    };

    extraConfig = ''
      # Custom aliases
      alias e    edit
      alias q    quit
      alias q!   quit!
      alias qa   quitall
      alias qa!  quitall!
      alias qall quitall
      alias setl setlocal
      alias filter     scout -prts
      alias find       scout -aets
      alias mark       scout -mr
      alias unmark     scout -Mr
      alias search     scout -rs
      alias search_inc scout -rts
      alias travel     scout -aefklst

      # Custom commands
      map DD shell mv %s ~/.Trash
      map dT shell trash-put %s
      map <C-f> fzf_select
      map <C-g> fzf_locate
      map bg shell cp %s ~/Desktop
      map mkd console mkdir%space
      map sc shell du -sh %s
      map V shell code %s
      map vs shell code -r %s
      map o shell open %s

      # Better navigation
      map gh cd ~
      map gd cd ~/Downloads
      map gD cd ~/Desktop
      map gc cd ~/.config
      map gw cd {{ .workspace }}
      map ge cd {{ .workspace_extra }}
      map gr cd {{ .resources }}
      map gp cd {{ .primary_cloud }}
      map gi cd {{ .primary_cloud }}/0-Inbox
      map gP cd {{ .playground }}

      # Image preview for common formats
      map i display_file

      # Git integration
      map ggA shell git add %s
      map ggC shell git commit
      map ggS shell git status
      map ggP shell git push
      map ggL shell git log --oneline
    '';

    rifle = [
      # Text files
      { condition = "mime ^text, label editor"; command = "nvim -- \"$@\""; }
      { condition = "mime ^text, label pager"; command = "bat -- \"$@\""; }

      # Code files
      { condition = "ext py"; command = "nvim -- \"$@\""; }
      { condition = "ext js|ts|jsx|tsx|json|yaml|yml|toml"; command = "nvim -- \"$@\""; }
      { condition = "ext nix|conf|config|cfg"; command = "nvim -- \"$@\""; }

      # Documents
      { condition = "ext pdf"; command = "open -- \"$@\""; }
      { condition = "ext docx?|xlsx?|pptx?"; command = "open -- \"$@\""; }

      # Media
      { condition = "mime ^image"; command = "open -- \"$@\""; }
      { condition = "mime ^video"; command = "open -- \"$@\""; }
      { condition = "mime ^audio"; command = "open -- \"$@\""; }

      # Archives
      { condition = "ext zip|tar|gz|bz2|xz"; command = "aunpack -- \"$@\""; }

      # Directories
      { condition = "directory"; command = "ranger -- \"$@\""; }
    ];
  };
}
