# -*- mode: nix; -*-
{ config, lib, pkgs, ... }:

{
{{- if eq .chezmoi.os "darwin" }}
  # Create a LaunchAgent for espanso to start automatically on macOS
  launchd.agents.espanso = {
    enable = true;
    config = {
      ProgramArguments = [
        "${pkgs.espanso}/bin/espanso"
        "service"
        "start"
        "--unmanaged"
      ];
      RunAtLoad = true;
      KeepAlive = true;
      StandardOutPath = "${config.home.homeDirectory}/.local/var/log/espanso.log";
      StandardErrorPath = "${config.home.homeDirectory}/.local/var/log/espanso.log";
    };
  };

  # Ensure log directory exists
  home.file.".local/var/log/.keep".text = "";
{{- end }}
}