{{ if eq .osid "linux-debian" "linux-raspbian" "linux-ubuntu" -}}


{{ $packages := list
     "age"
     "asciinema"
     "atop"
     "bash"
     "bat"
     "build-essential"
     "ca-certificates"
     "chafa"
     "cmake"
     "curl"
     "direnv"
     "fd-find"
     "fzf"
     "gcc"
     "git"
     "git-absorb"
     "git-lfs"
     "gnupg"
     "gpg"
     "htop"
     "iftop"
     "jq"
     "libfuse2"
     "lsb-release"
     "lsof"
     "make"
     "ncdu"
     "neofetch"
     "neovim"
     "python3-pip"
	 "inetutils-telnet"
	 "openssh-server"
	 "openvpn"
     "ranger"
     "ripgrep"
     "shellcheck"
	 "snapd"
     "tmux"
     "tmuxinator"
     "trash-cli"
     "tree"
	 "thefuck"
     "units"
     "vim"
     "wget"
     "zsh"
     "zsh-autosuggestions"
     "zsh-syntax-highlighting"
     "zsh" -}}

{{ $fonts := list
     "fonts-firacode"
     "fonts-jetbrains-mono" -}}

{{ $snap_packages := list
	 "core"
     "kubectl --classic"
	 "helm --classic" -}}

{{ if not .ephemeral -}}
{{   $packages = concat $packages (list "i3" "keepassxc" "alacritty") -}}
{{ end -}}

{{ $sudo := "sudo " -}}
{{ if eq .chezmoi.username "root" -}}
{{   $sudo = "" -}}
{{ end -}}

#!/bin/bash

set -eufo pipefail

{{ $sudo }}apt update
{{ $sudo }}apt install -y {{ $packages | join " " }} {{ $fonts | join " " }}

# Install snap packages
{{ range $snap_packages }}
{{ $sudo }}snap install {{ . }}
{{ end }}

# Check if Go is enabled and not already installed
if [ "{{ .goEnabled }}" = "true" ]; then
  if ! command -v go &> /dev/null; then
    echo "Go installation..."
    {{ $sudo }}apt install -y golang-go
  else
    echo "Go is already installed. Skipping installation."
  fi
fi

# Check if Rust is enabled and not already installed
if [ "{{ .rustEnabled }}" = "true" ]; then
  if ! command -v rustc &> /dev/null; then
    echo "Rust installation..."
    curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
  else
    echo "Rust is already installed. Skipping installation."
  fi
fi

{{ if not .ephemeral -}}
# Check if Proton VPN not already installed
# https://protonvpn.com/support/official-linux-vpn-debian/
if ! command -v protonvpn-app &> /dev/null; then
	echo "Proton VPN installation..."
	wget https://repo.protonvpn.com/debian/dists/stable/main/binary-all/protonvpn-stable-release_1.0.8_all.deb
	{{ $sudo }} dpkg -i ./protonvpn-stable-release_1.0.8_all.deb && {{ $sudo }} apt update
	echo "0b14e71586b22e498eb20926c48c7b434b751149b1f2af9902ef1cfe6b03e180 protonvpn-stable-release_1.0.8_all.deb" | sha256sum --check -
	{{ $sudo }}apt install proton-vpn-gnome-desktop
	{{ $sudo }}apt install libayatana-appindicator3-1 gir1.2-ayatanaappindicator3-0.1 gnome-shell-extension-appindicator
else
	echo "Proton Pass is already installed. Skipping installation."
fi
{{ end -}}

# Check if Atuin is enabled and not already installed
curl --proto '=https' --tlsv1.2 -LsSf https://setup.atuin.sh | sh

{{ end -}}
