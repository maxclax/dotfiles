(function(){const E=document.createElement("link").relList;if(E&&E.supports&&E.supports("modulepreload"))return;for(const H of document.querySelectorAll('link[rel="modulepreload"]'))et(H);new MutationObserver(H=>{for(const K of H)if(K.type==="childList")for(const D of K.addedNodes)D.tagName==="LINK"&&D.rel==="modulepreload"&&et(D)}).observe(document,{childList:!0,subtree:!0});function X(H){const K={};return H.integrity&&(K.integrity=H.integrity),H.referrerPolicy&&(K.referrerPolicy=H.referrerPolicy),H.crossOrigin==="use-credentials"?K.credentials="include":H.crossOrigin==="anonymous"?K.credentials="omit":K.credentials="same-origin",K}function et(H){if(H.ep)return;H.ep=!0;const K=X(H);fetch(H.href,K)}})();var Cn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},On={exports:{}};/*! For license information please see lsplugin.user.js.LICENSE.txt */On.exports;(function(u,E){(function(X,et){u.exports=et()})(self,()=>(()=>{var X={227:(D,d,S)=>{var T=S(155);d.formatArgs=function(U){if(U[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+U[0]+(this.useColors?"%c ":" ")+"+"+D.exports.humanize(this.diff),!this.useColors)return;const Y="color: "+this.color;U.splice(1,0,Y,"color: inherit");let b=0,p=0;U[0].replace(/%[a-zA-Z%]/g,w=>{w!=="%%"&&(b++,w==="%c"&&(p=b))}),U.splice(p,0,Y)},d.save=function(U){try{U?d.storage.setItem("debug",U):d.storage.removeItem("debug")}catch{}},d.load=function(){let U;try{U=d.storage.getItem("debug")}catch{}return!U&&T!==void 0&&"env"in T&&(U=T.env.DEBUG),U},d.useColors=function(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},d.storage=function(){try{return localStorage}catch{}}(),d.destroy=(()=>{let U=!1;return()=>{U||(U=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),d.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],d.log=console.debug||console.log||(()=>{}),D.exports=S(447)(d);const{formatters:k}=D.exports;k.j=function(U){try{return JSON.stringify(U)}catch(Y){return"[UnexpectedJSONParseError]: "+Y.message}}},447:(D,d,S)=>{D.exports=function(T){function k(b){let p,w,f,x=null;function v(...F){if(!v.enabled)return;const $=v,I=Number(new Date),L=I-(p||I);$.diff=L,$.prev=p,$.curr=I,p=I,F[0]=k.coerce(F[0]),typeof F[0]!="string"&&F.unshift("%O");let i=0;F[0]=F[0].replace(/%([a-zA-Z%])/g,(l,g)=>{if(l==="%%")return"%";i++;const y=k.formatters[g];if(typeof y=="function"){const G=F[i];l=y.call($,G),F.splice(i,1),i--}return l}),k.formatArgs.call($,F),($.log||k.log).apply($,F)}return v.namespace=b,v.useColors=k.useColors(),v.color=k.selectColor(b),v.extend=U,v.destroy=k.destroy,Object.defineProperty(v,"enabled",{enumerable:!0,configurable:!1,get:()=>x!==null?x:(w!==k.namespaces&&(w=k.namespaces,f=k.enabled(b)),f),set:F=>{x=F}}),typeof k.init=="function"&&k.init(v),v}function U(b,p){const w=k(this.namespace+(p===void 0?":":p)+b);return w.log=this.log,w}function Y(b){return b.toString().substring(2,b.toString().length-2).replace(/\.\*\?$/,"*")}return k.debug=k,k.default=k,k.coerce=function(b){return b instanceof Error?b.stack||b.message:b},k.disable=function(){const b=[...k.names.map(Y),...k.skips.map(Y).map(p=>"-"+p)].join(",");return k.enable(""),b},k.enable=function(b){let p;k.save(b),k.namespaces=b,k.names=[],k.skips=[];const w=(typeof b=="string"?b:"").split(/[\s,]+/),f=w.length;for(p=0;p<f;p++)w[p]&&((b=w[p].replace(/\*/g,".*?"))[0]==="-"?k.skips.push(new RegExp("^"+b.slice(1)+"$")):k.names.push(new RegExp("^"+b+"$")))},k.enabled=function(b){if(b[b.length-1]==="*")return!0;let p,w;for(p=0,w=k.skips.length;p<w;p++)if(k.skips[p].test(b))return!1;for(p=0,w=k.names.length;p<w;p++)if(k.names[p].test(b))return!0;return!1},k.humanize=S(824),k.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(T).forEach(b=>{k[b]=T[b]}),k.names=[],k.skips=[],k.formatters={},k.selectColor=function(b){let p=0;for(let w=0;w<b.length;w++)p=(p<<5)-p+b.charCodeAt(w),p|=0;return k.colors[Math.abs(p)%k.colors.length]},k.enable(k.load()),k}},996:D=>{var d=function(f){return function(x){return!!x&&typeof x=="object"}(f)&&!function(x){var v=Object.prototype.toString.call(x);return v==="[object RegExp]"||v==="[object Date]"||function(F){return F.$$typeof===S}(x)}(f)},S=typeof Symbol=="function"&&Symbol.for?Symbol.for("react.element"):60103;function T(f,x){return x.clone!==!1&&x.isMergeableObject(f)?p((v=f,Array.isArray(v)?[]:{}),f,x):f;var v}function k(f,x,v){return f.concat(x).map(function(F){return T(F,v)})}function U(f){return Object.keys(f).concat(function(x){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(x).filter(function(v){return Object.propertyIsEnumerable.call(x,v)}):[]}(f))}function Y(f,x){try{return x in f}catch{return!1}}function b(f,x,v){var F={};return v.isMergeableObject(f)&&U(f).forEach(function($){F[$]=T(f[$],v)}),U(x).forEach(function($){(function(I,L){return Y(I,L)&&!(Object.hasOwnProperty.call(I,L)&&Object.propertyIsEnumerable.call(I,L))})(f,$)||(Y(f,$)&&v.isMergeableObject(x[$])?F[$]=function(I,L){if(!L.customMerge)return p;var i=L.customMerge(I);return typeof i=="function"?i:p}($,v)(f[$],x[$],v):F[$]=T(x[$],v))}),F}function p(f,x,v){(v=v||{}).arrayMerge=v.arrayMerge||k,v.isMergeableObject=v.isMergeableObject||d,v.cloneUnlessOtherwiseSpecified=T;var F=Array.isArray(x);return F===Array.isArray(f)?F?v.arrayMerge(f,x,v):b(f,x,v):T(x,v)}p.all=function(f,x){if(!Array.isArray(f))throw new Error("first argument should be an array");return f.reduce(function(v,F){return p(v,F,x)},{})};var w=p;D.exports=w},856:function(D){D.exports=function(){function d(A){return d=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(M){return typeof M}:function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},d(A)}function S(A,M){return S=Object.setPrototypeOf||function(q,V){return q.__proto__=V,q},S(A,M)}function T(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function k(A,M,q){return k=T()?Reflect.construct:function(V,pt,Pt){var Gt=[null];Gt.push.apply(Gt,pt);var ne=new(Function.bind.apply(V,Gt));return Pt&&S(ne,Pt.prototype),ne},k.apply(null,arguments)}function U(A){return Y(A)||b(A)||p(A)||f()}function Y(A){if(Array.isArray(A))return w(A)}function b(A){if(typeof Symbol<"u"&&A[Symbol.iterator]!=null||A["@@iterator"]!=null)return Array.from(A)}function p(A,M){if(A){if(typeof A=="string")return w(A,M);var q=Object.prototype.toString.call(A).slice(8,-1);return q==="Object"&&A.constructor&&(q=A.constructor.name),q==="Map"||q==="Set"?Array.from(A):q==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(q)?w(A,M):void 0}}function w(A,M){(M==null||M>A.length)&&(M=A.length);for(var q=0,V=new Array(M);q<M;q++)V[q]=A[q];return V}function f(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var x=Object.hasOwnProperty,v=Object.setPrototypeOf,F=Object.isFrozen,$=Object.getPrototypeOf,I=Object.getOwnPropertyDescriptor,L=Object.freeze,i=Object.seal,l=Object.create,g=typeof Reflect<"u"&&Reflect,y=g.apply,G=g.construct;y||(y=function(A,M,q){return A.apply(M,q)}),L||(L=function(A){return A}),i||(i=function(A){return A}),G||(G=function(A,M){return k(A,U(M))});var nt=tt(Array.prototype.forEach),at=tt(Array.prototype.pop),ht=tt(Array.prototype.push),wt=tt(String.prototype.toLowerCase),At=tt(String.prototype.match),bt=tt(String.prototype.replace),Se=tt(String.prototype.indexOf),h=tt(String.prototype.trim),_=tt(RegExp.prototype.test),z=St(TypeError);function tt(A){return function(M){for(var q=arguments.length,V=new Array(q>1?q-1:0),pt=1;pt<q;pt++)V[pt-1]=arguments[pt];return y(A,M,V)}}function St(A){return function(){for(var M=arguments.length,q=new Array(M),V=0;V<M;V++)q[V]=arguments[V];return G(A,q)}}function N(A,M){v&&v(A,null);for(var q=M.length;q--;){var V=M[q];if(typeof V=="string"){var pt=wt(V);pt!==V&&(F(M)||(M[q]=pt),V=pt)}A[V]=!0}return A}function Z(A){var M,q=l(null);for(M in A)y(x,A,[M])&&(q[M]=A[M]);return q}function st(A,M){for(;A!==null;){var q=I(A,M);if(q){if(q.get)return tt(q.get);if(typeof q.value=="function")return tt(q.value)}A=$(A)}function V(pt){return console.warn("fallback value for",pt),null}return V}var jt=L(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),xt=L(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Ft=L(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),ee=L(["animate","color-profile","cursor","discard","fedropshadow","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),ft=L(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"]),lt=L(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Ot=L(["#text"]),kt=L(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns","slot"]),Rt=L(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Kt=L(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Lt=L(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Tt=i(/\{\{[\w\W]*|[\w\W]*\}\}/gm),he=i(/<%[\w\W]*|[\w\W]*%>/gm),En=i(/^data-[\-\w.\u00B7-\uFFFF]/),Ut=i(/^aria-[\-\w]+$/),Wt=i(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Qe=i(/^(?:\w+script|data):/i),jn=i(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),kn=i(/^html$/i),pe=function(){return typeof window>"u"?null:window},Tn=function(A,M){if(d(A)!=="object"||typeof A.createPolicy!="function")return null;var q=null,V="data-tt-policy-suffix";M.currentScript&&M.currentScript.hasAttribute(V)&&(q=M.currentScript.getAttribute(V));var pt="dompurify"+(q?"#"+q:"");try{return A.createPolicy(pt,{createHTML:function(Pt){return Pt}})}catch{return console.warn("TrustedTypes policy "+pt+" could not be created."),null}};function Xe(){var A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:pe(),M=function(o){return Xe(o)};if(M.version="2.3.8",M.removed=[],!A||!A.document||A.document.nodeType!==9)return M.isSupported=!1,M;var q=A.document,V=A.document,pt=A.DocumentFragment,Pt=A.HTMLTemplateElement,Gt=A.Node,ne=A.Element,Pe=A.NodeFilter,tn=A.NamedNodeMap,Yt=tn===void 0?A.NamedNodeMap||A.MozNamedAttrMap:tn,In=A.HTMLFormElement,Fn=A.DOMParser,Ln=A.trustedTypes,Oe=ne.prototype,Mn=st(Oe,"cloneNode"),Nn=st(Oe,"nextSibling"),Rn=st(Oe,"childNodes"),De=st(Oe,"parentNode");if(typeof Pt=="function"){var Dt=V.createElement("template");Dt.content&&Dt.content.ownerDocument&&(V=Dt.content.ownerDocument)}var $t=Tn(Ln,q),en=$t?$t.createHTML(""):"",Ee=V,$e=Ee.implementation,re=Ee.createNodeIterator,nn=Ee.createDocumentFragment,rn=Ee.getElementsByTagName,Un=q.importNode,on={};try{on=Z(V).documentMode?V.documentMode:{}}catch{}var Mt={};M.isSupported=typeof De=="function"&&$e&&$e.createHTMLDocument!==void 0&&on!==9;var me,Jt,je=Tt,ke=he,ze=En,Pn=Ut,sn=Qe,Te=jn,rt=Wt,mt=null,an=N({},[].concat(U(jt),U(xt),U(Ft),U(ft),U(Ot))),gt=null,oe=N({},[].concat(U(kt),U(Rt),U(Kt),U(Lt))),ut=Object.seal(Object.create(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),ie=null,Ie=null,Be=!0,He=!0,cn=!1,se=!1,Qt=!1,qe=!1,We=!1,ae=!1,Fe=!1,ce=!1,ln=!0,Ge=!0,le=!1,zt={},ue=null,un=N({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),fn=null,dn=N({},["audio","video","img","source","image","track"]),Je=null,Xt=N({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),fe="http://www.w3.org/1998/Math/MathML",Ze="http://www.w3.org/2000/svg",Zt="http://www.w3.org/1999/xhtml",Le=Zt,hn=!1,ge=["application/xhtml+xml","text/html"],ye="text/html",de=null,Dn=V.createElement("form"),pn=function(o){return o instanceof RegExp||o instanceof Function},Ve=function(o){de&&de===o||(o&&d(o)==="object"||(o={}),o=Z(o),mt="ALLOWED_TAGS"in o?N({},o.ALLOWED_TAGS):an,gt="ALLOWED_ATTR"in o?N({},o.ALLOWED_ATTR):oe,Je="ADD_URI_SAFE_ATTR"in o?N(Z(Xt),o.ADD_URI_SAFE_ATTR):Xt,fn="ADD_DATA_URI_TAGS"in o?N(Z(dn),o.ADD_DATA_URI_TAGS):dn,ue="FORBID_CONTENTS"in o?N({},o.FORBID_CONTENTS):un,ie="FORBID_TAGS"in o?N({},o.FORBID_TAGS):{},Ie="FORBID_ATTR"in o?N({},o.FORBID_ATTR):{},zt="USE_PROFILES"in o&&o.USE_PROFILES,Be=o.ALLOW_ARIA_ATTR!==!1,He=o.ALLOW_DATA_ATTR!==!1,cn=o.ALLOW_UNKNOWN_PROTOCOLS||!1,se=o.SAFE_FOR_TEMPLATES||!1,Qt=o.WHOLE_DOCUMENT||!1,ae=o.RETURN_DOM||!1,Fe=o.RETURN_DOM_FRAGMENT||!1,ce=o.RETURN_TRUSTED_TYPE||!1,We=o.FORCE_BODY||!1,ln=o.SANITIZE_DOM!==!1,Ge=o.KEEP_CONTENT!==!1,le=o.IN_PLACE||!1,rt=o.ALLOWED_URI_REGEXP||rt,Le=o.NAMESPACE||Zt,o.CUSTOM_ELEMENT_HANDLING&&pn(o.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(ut.tagNameCheck=o.CUSTOM_ELEMENT_HANDLING.tagNameCheck),o.CUSTOM_ELEMENT_HANDLING&&pn(o.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(ut.attributeNameCheck=o.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),o.CUSTOM_ELEMENT_HANDLING&&typeof o.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(ut.allowCustomizedBuiltInElements=o.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),me=me=ge.indexOf(o.PARSER_MEDIA_TYPE)===-1?ye:o.PARSER_MEDIA_TYPE,Jt=me==="application/xhtml+xml"?function(j){return j}:wt,se&&(He=!1),Fe&&(ae=!0),zt&&(mt=N({},U(Ot)),gt=[],zt.html===!0&&(N(mt,jt),N(gt,kt)),zt.svg===!0&&(N(mt,xt),N(gt,Rt),N(gt,Lt)),zt.svgFilters===!0&&(N(mt,Ft),N(gt,Rt),N(gt,Lt)),zt.mathMl===!0&&(N(mt,ft),N(gt,Kt),N(gt,Lt))),o.ADD_TAGS&&(mt===an&&(mt=Z(mt)),N(mt,o.ADD_TAGS)),o.ADD_ATTR&&(gt===oe&&(gt=Z(gt)),N(gt,o.ADD_ATTR)),o.ADD_URI_SAFE_ATTR&&N(Je,o.ADD_URI_SAFE_ATTR),o.FORBID_CONTENTS&&(ue===un&&(ue=Z(ue)),N(ue,o.FORBID_CONTENTS)),Ge&&(mt["#text"]=!0),Qt&&N(mt,["html","head","body"]),mt.table&&(N(mt,["tbody"]),delete ie.tbody),L&&L(o),de=o)},mn=N({},["mi","mo","mn","ms","mtext"]),gn=N({},["foreignobject","desc","title","annotation-xml"]),$n=N({},["title","style","font","a","script"]),Bt=N({},xt);N(Bt,Ft),N(Bt,ee);var Me=N({},ft);N(Me,lt);var zn=function(o){var j=De(o);j&&j.tagName||(j={namespaceURI:Zt,tagName:"template"});var C=wt(o.tagName),ot=wt(j.tagName);return o.namespaceURI===Ze?j.namespaceURI===Zt?C==="svg":j.namespaceURI===fe?C==="svg"&&(ot==="annotation-xml"||mn[ot]):!!Bt[C]:o.namespaceURI===fe?j.namespaceURI===Zt?C==="math":j.namespaceURI===Ze?C==="math"&&gn[ot]:!!Me[C]:o.namespaceURI===Zt&&!(j.namespaceURI===Ze&&!gn[ot])&&!(j.namespaceURI===fe&&!mn[ot])&&!Me[C]&&($n[C]||!Bt[C])},Ht=function(o){ht(M.removed,{element:o});try{o.parentNode.removeChild(o)}catch{try{o.outerHTML=en}catch{o.remove()}}},ve=function(o,j){try{ht(M.removed,{attribute:j.getAttributeNode(o),from:j})}catch{ht(M.removed,{attribute:null,from:j})}if(j.removeAttribute(o),o==="is"&&!gt[o])if(ae||Fe)try{Ht(j)}catch{}else try{j.setAttribute(o,"")}catch{}},yn=function(o){var j,C;if(We)o="<remove></remove>"+o;else{var ot=At(o,/^[\r\n\t ]+/);C=ot&&ot[0]}me==="application/xhtml+xml"&&(o='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+o+"</body></html>");var dt=$t?$t.createHTML(o):o;if(Le===Zt)try{j=new Fn().parseFromString(dt,me)}catch{}if(!j||!j.documentElement){j=$e.createDocument(Le,"template",null);try{j.documentElement.innerHTML=hn?"":dt}catch{}}var _t=j.body||j.documentElement;return o&&C&&_t.insertBefore(V.createTextNode(C),_t.childNodes[0]||null),Le===Zt?rn.call(j,Qt?"html":"body")[0]:Qt?j.documentElement:_t},vn=function(o){return re.call(o.ownerDocument||o,o,Pe.SHOW_ELEMENT|Pe.SHOW_COMMENT|Pe.SHOW_TEXT,null,!1)},Bn=function(o){return o instanceof In&&(typeof o.nodeName!="string"||typeof o.textContent!="string"||typeof o.removeChild!="function"||!(o.attributes instanceof Yt)||typeof o.removeAttribute!="function"||typeof o.setAttribute!="function"||typeof o.namespaceURI!="string"||typeof o.insertBefore!="function")},be=function(o){return d(Gt)==="object"?o instanceof Gt:o&&d(o)==="object"&&typeof o.nodeType=="number"&&typeof o.nodeName=="string"},Et=function(o,j,C){Mt[o]&&nt(Mt[o],function(ot){ot.call(M,j,C,de)})},_e=function(o){var j;if(Et("beforeSanitizeElements",o,null),Bn(o)||_(/[\u0080-\uFFFF]/,o.nodeName))return Ht(o),!0;var C=Jt(o.nodeName);if(Et("uponSanitizeElement",o,{tagName:C,allowedTags:mt}),o.hasChildNodes()&&!be(o.firstElementChild)&&(!be(o.content)||!be(o.content.firstElementChild))&&_(/<[/\w]/g,o.innerHTML)&&_(/<[/\w]/g,o.textContent)||C==="select"&&_(/<template/i,o.innerHTML))return Ht(o),!0;if(!mt[C]||ie[C]){if(!ie[C]&&te(C)&&(ut.tagNameCheck instanceof RegExp&&_(ut.tagNameCheck,C)||ut.tagNameCheck instanceof Function&&ut.tagNameCheck(C)))return!1;if(Ge&&!ue[C]){var ot=De(o)||o.parentNode,dt=Rn(o)||o.childNodes;if(dt&&ot)for(var _t=dt.length-1;_t>=0;--_t)ot.insertBefore(Mn(dt[_t],!0),Nn(o))}return Ht(o),!0}return o instanceof ne&&!zn(o)?(Ht(o),!0):C!=="noscript"&&C!=="noembed"||!_(/<\/no(script|embed)/i,o.innerHTML)?(se&&o.nodeType===3&&(j=o.textContent,j=bt(j,je," "),j=bt(j,ke," "),o.textContent!==j&&(ht(M.removed,{element:o.cloneNode()}),o.textContent=j)),Et("afterSanitizeElements",o,null),!1):(Ht(o),!0)},bn=function(o,j,C){if(ln&&(j==="id"||j==="name")&&(C in V||C in Dn))return!1;if(!(He&&!Ie[j]&&_(ze,j))){if(!(Be&&_(Pn,j))){if(!gt[j]||Ie[j]){if(!(te(o)&&(ut.tagNameCheck instanceof RegExp&&_(ut.tagNameCheck,o)||ut.tagNameCheck instanceof Function&&ut.tagNameCheck(o))&&(ut.attributeNameCheck instanceof RegExp&&_(ut.attributeNameCheck,j)||ut.attributeNameCheck instanceof Function&&ut.attributeNameCheck(j))||j==="is"&&ut.allowCustomizedBuiltInElements&&(ut.tagNameCheck instanceof RegExp&&_(ut.tagNameCheck,C)||ut.tagNameCheck instanceof Function&&ut.tagNameCheck(C))))return!1}else if(!Je[j]){if(!_(rt,bt(C,Te,""))){if((j!=="src"&&j!=="xlink:href"&&j!=="href"||o==="script"||Se(C,"data:")!==0||!fn[o])&&!(cn&&!_(sn,bt(C,Te,"")))){if(C)return!1}}}}}return!0},te=function(o){return o.indexOf("-")>0},we=function(o){var j,C,ot,dt;Et("beforeSanitizeAttributes",o,null);var _t=o.attributes;if(_t){var yt={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:gt};for(dt=_t.length;dt--;){var xe=j=_t[dt],Vt=xe.name,It=xe.namespaceURI;if(C=Vt==="value"?j.value:h(j.value),ot=Jt(Vt),yt.attrName=ot,yt.attrValue=C,yt.keepAttr=!0,yt.forceKeepAttr=void 0,Et("uponSanitizeAttribute",o,yt),C=yt.attrValue,!yt.forceKeepAttr&&(ve(Vt,o),yt.keepAttr))if(_(/\/>/i,C))ve(Vt,o);else{se&&(C=bt(C,je," "),C=bt(C,ke," "));var Ke=Jt(o.nodeName);if(bn(Ke,ot,C))try{It?o.setAttributeNS(It,Vt,C):o.setAttribute(Vt,C),at(M.removed)}catch{}}}Et("afterSanitizeAttributes",o,null)}},Hn=function o(j){var C,ot=vn(j);for(Et("beforeSanitizeShadowDOM",j,null);C=ot.nextNode();)Et("uponSanitizeShadowNode",C,null),_e(C)||(C.content instanceof pt&&o(C.content),we(C));Et("afterSanitizeShadowDOM",j,null)};return M.sanitize=function(o,j){var C,ot,dt,_t,yt;if((hn=!o)&&(o="<!-->"),typeof o!="string"&&!be(o)){if(typeof o.toString!="function")throw z("toString is not a function");if(typeof(o=o.toString())!="string")throw z("dirty is not a string, aborting")}if(!M.isSupported){if(d(A.toStaticHTML)==="object"||typeof A.toStaticHTML=="function"){if(typeof o=="string")return A.toStaticHTML(o);if(be(o))return A.toStaticHTML(o.outerHTML)}return o}if(qe||Ve(j),M.removed=[],typeof o=="string"&&(le=!1),le){if(o.nodeName){var xe=Jt(o.nodeName);if(!mt[xe]||ie[xe])throw z("root node is forbidden and cannot be sanitized in-place")}}else if(o instanceof Gt)(ot=(C=yn("<!---->")).ownerDocument.importNode(o,!0)).nodeType===1&&ot.nodeName==="BODY"||ot.nodeName==="HTML"?C=ot:C.appendChild(ot);else{if(!ae&&!se&&!Qt&&o.indexOf("<")===-1)return $t&&ce?$t.createHTML(o):o;if(!(C=yn(o)))return ae?null:ce?en:""}C&&We&&Ht(C.firstChild);for(var Vt=vn(le?o:C);dt=Vt.nextNode();)dt.nodeType===3&&dt===_t||_e(dt)||(dt.content instanceof pt&&Hn(dt.content),we(dt),_t=dt);if(_t=null,le)return o;if(ae){if(Fe)for(yt=nn.call(C.ownerDocument);C.firstChild;)yt.appendChild(C.firstChild);else yt=C;return gt.shadowroot&&(yt=Un.call(q,yt,!0)),yt}var It=Qt?C.outerHTML:C.innerHTML;return Qt&&mt["!doctype"]&&C.ownerDocument&&C.ownerDocument.doctype&&C.ownerDocument.doctype.name&&_(kn,C.ownerDocument.doctype.name)&&(It="<!DOCTYPE "+C.ownerDocument.doctype.name+`>
`+It),se&&(It=bt(It,je," "),It=bt(It,ke," ")),$t&&ce?$t.createHTML(It):It},M.setConfig=function(o){Ve(o),qe=!0},M.clearConfig=function(){de=null,qe=!1},M.isValidAttribute=function(o,j,C){de||Ve({});var ot=Jt(o),dt=Jt(j);return bn(ot,dt,C)},M.addHook=function(o,j){typeof j=="function"&&(Mt[o]=Mt[o]||[],ht(Mt[o],j))},M.removeHook=function(o){if(Mt[o])return at(Mt[o])},M.removeHooks=function(o){Mt[o]&&(Mt[o]=[])},M.removeAllHooks=function(){Mt={}},M}return Xe()}()},729:D=>{var d=Object.prototype.hasOwnProperty,S="~";function T(){}function k(p,w,f){this.fn=p,this.context=w,this.once=f||!1}function U(p,w,f,x,v){if(typeof f!="function")throw new TypeError("The listener must be a function");var F=new k(f,x||p,v),$=S?S+w:w;return p._events[$]?p._events[$].fn?p._events[$]=[p._events[$],F]:p._events[$].push(F):(p._events[$]=F,p._eventsCount++),p}function Y(p,w){--p._eventsCount==0?p._events=new T:delete p._events[w]}function b(){this._events=new T,this._eventsCount=0}Object.create&&(T.prototype=Object.create(null),new T().__proto__||(S=!1)),b.prototype.eventNames=function(){var p,w,f=[];if(this._eventsCount===0)return f;for(w in p=this._events)d.call(p,w)&&f.push(S?w.slice(1):w);return Object.getOwnPropertySymbols?f.concat(Object.getOwnPropertySymbols(p)):f},b.prototype.listeners=function(p){var w=S?S+p:p,f=this._events[w];if(!f)return[];if(f.fn)return[f.fn];for(var x=0,v=f.length,F=new Array(v);x<v;x++)F[x]=f[x].fn;return F},b.prototype.listenerCount=function(p){var w=S?S+p:p,f=this._events[w];return f?f.fn?1:f.length:0},b.prototype.emit=function(p,w,f,x,v,F){var $=S?S+p:p;if(!this._events[$])return!1;var I,L,i=this._events[$],l=arguments.length;if(i.fn){switch(i.once&&this.removeListener(p,i.fn,void 0,!0),l){case 1:return i.fn.call(i.context),!0;case 2:return i.fn.call(i.context,w),!0;case 3:return i.fn.call(i.context,w,f),!0;case 4:return i.fn.call(i.context,w,f,x),!0;case 5:return i.fn.call(i.context,w,f,x,v),!0;case 6:return i.fn.call(i.context,w,f,x,v,F),!0}for(L=1,I=new Array(l-1);L<l;L++)I[L-1]=arguments[L];i.fn.apply(i.context,I)}else{var g,y=i.length;for(L=0;L<y;L++)switch(i[L].once&&this.removeListener(p,i[L].fn,void 0,!0),l){case 1:i[L].fn.call(i[L].context);break;case 2:i[L].fn.call(i[L].context,w);break;case 3:i[L].fn.call(i[L].context,w,f);break;case 4:i[L].fn.call(i[L].context,w,f,x);break;default:if(!I)for(g=1,I=new Array(l-1);g<l;g++)I[g-1]=arguments[g];i[L].fn.apply(i[L].context,I)}}return!0},b.prototype.on=function(p,w,f){return U(this,p,w,f,!1)},b.prototype.once=function(p,w,f){return U(this,p,w,f,!0)},b.prototype.removeListener=function(p,w,f,x){var v=S?S+p:p;if(!this._events[v])return this;if(!w)return Y(this,v),this;var F=this._events[v];if(F.fn)F.fn!==w||x&&!F.once||f&&F.context!==f||Y(this,v);else{for(var $=0,I=[],L=F.length;$<L;$++)(F[$].fn!==w||x&&!F[$].once||f&&F[$].context!==f)&&I.push(F[$]);I.length?this._events[v]=I.length===1?I[0]:I:Y(this,v)}return this},b.prototype.removeAllListeners=function(p){var w;return p?(w=S?S+p:p,this._events[w]&&Y(this,w)):(this._events=new T,this._eventsCount=0),this},b.prototype.off=b.prototype.removeListener,b.prototype.addListener=b.prototype.on,b.prefixed=S,b.EventEmitter=b,D.exports=b},717:D=>{typeof Object.create=="function"?D.exports=function(d,S){d.super_=S,d.prototype=Object.create(S.prototype,{constructor:{value:d,enumerable:!1,writable:!0,configurable:!0}})}:D.exports=function(d,S){d.super_=S;var T=function(){};T.prototype=S.prototype,d.prototype=new T,d.prototype.constructor=d}},824:D=>{var d=1e3,S=60*d,T=60*S,k=24*T,U=7*k,Y=365.25*k;function b(p,w,f,x){var v=w>=1.5*f;return Math.round(p/f)+" "+x+(v?"s":"")}D.exports=function(p,w){w=w||{};var f=typeof p;if(f==="string"&&p.length>0)return function(x){if(!((x=String(x)).length>100)){var v=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(x);if(v){var F=parseFloat(v[1]);switch((v[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return F*Y;case"weeks":case"week":case"w":return F*U;case"days":case"day":case"d":return F*k;case"hours":case"hour":case"hrs":case"hr":case"h":return F*T;case"minutes":case"minute":case"mins":case"min":case"m":return F*S;case"seconds":case"second":case"secs":case"sec":case"s":return F*d;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return F;default:return}}}}(p);if(f==="number"&&isFinite(p))return w.long?function(x){var v=Math.abs(x);return v>=k?b(x,v,k,"day"):v>=T?b(x,v,T,"hour"):v>=S?b(x,v,S,"minute"):v>=d?b(x,v,d,"second"):x+" ms"}(p):function(x){var v=Math.abs(x);return v>=k?Math.round(x/k)+"d":v>=T?Math.round(x/T)+"h":v>=S?Math.round(x/S)+"m":v>=d?Math.round(x/d)+"s":x+"ms"}(p);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(p))}},520:(D,d,S)=>{var T=S(155),k=T.platform==="win32",U=S(539);function Y(i,l){for(var g=[],y=0;y<i.length;y++){var G=i[y];G&&G!=="."&&(G===".."?g.length&&g[g.length-1]!==".."?g.pop():l&&g.push(".."):g.push(G))}return g}function b(i){for(var l=i.length-1,g=0;g<=l&&!i[g];g++);for(var y=l;y>=0&&!i[y];y--);return g===0&&y===l?i:g>y?[]:i.slice(g,y+1)}var p=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/,w=/^([\s\S]*?)((?:\.{1,2}|[^\\\/]+?|)(\.[^.\/\\]*|))(?:[\\\/]*)$/,f={};function x(i){var l=p.exec(i),g=(l[1]||"")+(l[2]||""),y=l[3]||"",G=w.exec(y);return[g,G[1],G[2],G[3]]}function v(i){var l=p.exec(i),g=l[1]||"",y=!!g&&g[1]!==":";return{device:g,isUnc:y,isAbsolute:y||!!l[2],tail:l[3]}}function F(i){return"\\\\"+i.replace(/^[\\\/]+/,"").replace(/[\\\/]+/g,"\\")}f.resolve=function(){for(var i="",l="",g=!1,y=arguments.length-1;y>=-1;y--){var G;if(y>=0?G=arguments[y]:i?(G=T.env["="+i])&&G.substr(0,3).toLowerCase()===i.toLowerCase()+"\\"||(G=i+"\\"):G=T.cwd(),!U.isString(G))throw new TypeError("Arguments to path.resolve must be strings");if(G){var nt=v(G),at=nt.device,ht=nt.isUnc,wt=nt.isAbsolute,At=nt.tail;if((!at||!i||at.toLowerCase()===i.toLowerCase())&&(i||(i=at),g||(l=At+"\\"+l,g=wt),i&&g))break}}return ht&&(i=F(i)),i+(g?"\\":"")+(l=Y(l.split(/[\\\/]+/),!g).join("\\"))||"."},f.normalize=function(i){var l=v(i),g=l.device,y=l.isUnc,G=l.isAbsolute,nt=l.tail,at=/[\\\/]$/.test(nt);return(nt=Y(nt.split(/[\\\/]+/),!G).join("\\"))||G||(nt="."),nt&&at&&(nt+="\\"),y&&(g=F(g)),g+(G?"\\":"")+nt},f.isAbsolute=function(i){return v(i).isAbsolute},f.join=function(){for(var i=[],l=0;l<arguments.length;l++){var g=arguments[l];if(!U.isString(g))throw new TypeError("Arguments to path.join must be strings");g&&i.push(g)}var y=i.join("\\");return/^[\\\/]{2}[^\\\/]/.test(i[0])||(y=y.replace(/^[\\\/]{2,}/,"\\")),f.normalize(y)},f.relative=function(i,l){i=f.resolve(i),l=f.resolve(l);for(var g=i.toLowerCase(),y=l.toLowerCase(),G=b(l.split("\\")),nt=b(g.split("\\")),at=b(y.split("\\")),ht=Math.min(nt.length,at.length),wt=ht,At=0;At<ht;At++)if(nt[At]!==at[At]){wt=At;break}if(wt==0)return l;var bt=[];for(At=wt;At<nt.length;At++)bt.push("..");return(bt=bt.concat(G.slice(wt))).join("\\")},f._makeLong=function(i){if(!U.isString(i))return i;if(!i)return"";var l=f.resolve(i);return/^[a-zA-Z]\:\\/.test(l)?"\\\\?\\"+l:/^\\\\[^?.]/.test(l)?"\\\\?\\UNC\\"+l.substring(2):i},f.dirname=function(i){var l=x(i),g=l[0],y=l[1];return g||y?(y&&(y=y.substr(0,y.length-1)),g+y):"."},f.basename=function(i,l){var g=x(i)[2];return l&&g.substr(-1*l.length)===l&&(g=g.substr(0,g.length-l.length)),g},f.extname=function(i){return x(i)[3]},f.format=function(i){if(!U.isObject(i))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof i);var l=i.root||"";if(!U.isString(l))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof i.root);var g=i.dir,y=i.base||"";return g?g[g.length-1]===f.sep?g+y:g+f.sep+y:y},f.parse=function(i){if(!U.isString(i))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof i);var l=x(i);if(!l||l.length!==4)throw new TypeError("Invalid path '"+i+"'");return{root:l[0],dir:l[0]+l[1].slice(0,-1),base:l[2],ext:l[3],name:l[2].slice(0,l[2].length-l[3].length)}},f.sep="\\",f.delimiter=";";var $=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,I={};function L(i){return $.exec(i).slice(1)}I.resolve=function(){for(var i="",l=!1,g=arguments.length-1;g>=-1&&!l;g--){var y=g>=0?arguments[g]:T.cwd();if(!U.isString(y))throw new TypeError("Arguments to path.resolve must be strings");y&&(i=y+"/"+i,l=y[0]==="/")}return(l?"/":"")+(i=Y(i.split("/"),!l).join("/"))||"."},I.normalize=function(i){var l=I.isAbsolute(i),g=i&&i[i.length-1]==="/";return(i=Y(i.split("/"),!l).join("/"))||l||(i="."),i&&g&&(i+="/"),(l?"/":"")+i},I.isAbsolute=function(i){return i.charAt(0)==="/"},I.join=function(){for(var i="",l=0;l<arguments.length;l++){var g=arguments[l];if(!U.isString(g))throw new TypeError("Arguments to path.join must be strings");g&&(i+=i?"/"+g:g)}return I.normalize(i)},I.relative=function(i,l){i=I.resolve(i).substr(1),l=I.resolve(l).substr(1);for(var g=b(i.split("/")),y=b(l.split("/")),G=Math.min(g.length,y.length),nt=G,at=0;at<G;at++)if(g[at]!==y[at]){nt=at;break}var ht=[];for(at=nt;at<g.length;at++)ht.push("..");return(ht=ht.concat(y.slice(nt))).join("/")},I._makeLong=function(i){return i},I.dirname=function(i){var l=L(i),g=l[0],y=l[1];return g||y?(y&&(y=y.substr(0,y.length-1)),g+y):"."},I.basename=function(i,l){var g=L(i)[2];return l&&g.substr(-1*l.length)===l&&(g=g.substr(0,g.length-l.length)),g},I.extname=function(i){return L(i)[3]},I.format=function(i){if(!U.isObject(i))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof i);var l=i.root||"";if(!U.isString(l))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof i.root);return(i.dir?i.dir+I.sep:"")+(i.base||"")},I.parse=function(i){if(!U.isString(i))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof i);var l=L(i);if(!l||l.length!==4)throw new TypeError("Invalid path '"+i+"'");return l[1]=l[1]||"",l[2]=l[2]||"",l[3]=l[3]||"",{root:l[0],dir:l[0]+l[1].slice(0,-1),base:l[2],ext:l[3],name:l[2].slice(0,l[2].length-l[3].length)}},I.sep="/",I.delimiter=":",D.exports=k?f:I,D.exports.posix=I,D.exports.win32=f},155:D=>{var d,S,T=D.exports={};function k(){throw new Error("setTimeout has not been defined")}function U(){throw new Error("clearTimeout has not been defined")}function Y(I){if(d===setTimeout)return setTimeout(I,0);if((d===k||!d)&&setTimeout)return d=setTimeout,setTimeout(I,0);try{return d(I,0)}catch{try{return d.call(null,I,0)}catch{return d.call(this,I,0)}}}(function(){try{d=typeof setTimeout=="function"?setTimeout:k}catch{d=k}try{S=typeof clearTimeout=="function"?clearTimeout:U}catch{S=U}})();var b,p=[],w=!1,f=-1;function x(){w&&b&&(w=!1,b.length?p=b.concat(p):f=-1,p.length&&v())}function v(){if(!w){var I=Y(x);w=!0;for(var L=p.length;L;){for(b=p,p=[];++f<L;)b&&b[f].run();f=-1,L=p.length}b=null,w=!1,function(i){if(S===clearTimeout)return clearTimeout(i);if((S===U||!S)&&clearTimeout)return S=clearTimeout,clearTimeout(i);try{S(i)}catch{try{return S.call(null,i)}catch{return S.call(this,i)}}}(I)}}function F(I,L){this.fun=I,this.array=L}function $(){}T.nextTick=function(I){var L=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)L[i-1]=arguments[i];p.push(new F(I,L)),p.length!==1||w||Y(v)},F.prototype.run=function(){this.fun.apply(null,this.array)},T.title="browser",T.browser=!0,T.env={},T.argv=[],T.version="",T.versions={},T.on=$,T.addListener=$,T.once=$,T.off=$,T.removeListener=$,T.removeAllListeners=$,T.emit=$,T.prependListener=$,T.prependOnceListener=$,T.listeners=function(I){return[]},T.binding=function(I){throw new Error("process.binding is not supported")},T.cwd=function(){return"/"},T.chdir=function(I){throw new Error("process.chdir is not supported")},T.umask=function(){return 0}},384:D=>{D.exports=function(d){return d&&typeof d=="object"&&typeof d.copy=="function"&&typeof d.fill=="function"&&typeof d.readUInt8=="function"}},539:(D,d,S)=>{var T=S(155),k=/%[sdj%]/g;d.format=function(h){if(!i(h)){for(var _=[],z=0;z<arguments.length;z++)_.push(b(arguments[z]));return _.join(" ")}z=1;for(var tt=arguments,St=tt.length,N=String(h).replace(k,function(st){if(st==="%%")return"%";if(z>=St)return st;switch(st){case"%s":return String(tt[z++]);case"%d":return Number(tt[z++]);case"%j":try{return JSON.stringify(tt[z++])}catch{return"[Circular]"}default:return st}}),Z=tt[z];z<St;Z=tt[++z])I(Z)||!y(Z)?N+=" "+Z:N+=" "+b(Z);return N},d.deprecate=function(h,_){if(l(S.g.process))return function(){return d.deprecate(h,_).apply(this,arguments)};if(T.noDeprecation===!0)return h;var z=!1;return function(){if(!z){if(T.throwDeprecation)throw new Error(_);T.traceDeprecation?console.trace(_):console.error(_),z=!0}return h.apply(this,arguments)}};var U,Y={};function b(h,_){var z={seen:[],stylize:w};return arguments.length>=3&&(z.depth=arguments[2]),arguments.length>=4&&(z.colors=arguments[3]),$(_)?z.showHidden=_:_&&d._extend(z,_),l(z.showHidden)&&(z.showHidden=!1),l(z.depth)&&(z.depth=2),l(z.colors)&&(z.colors=!1),l(z.customInspect)&&(z.customInspect=!0),z.colors&&(z.stylize=p),f(z,h,z.depth)}function p(h,_){var z=b.styles[_];return z?"\x1B["+b.colors[z][0]+"m"+h+"\x1B["+b.colors[z][1]+"m":h}function w(h,_){return h}function f(h,_,z){if(h.customInspect&&_&&at(_.inspect)&&_.inspect!==d.inspect&&(!_.constructor||_.constructor.prototype!==_)){var tt=_.inspect(z,h);return i(tt)||(tt=f(h,tt,z)),tt}var St=function(ft,lt){if(l(lt))return ft.stylize("undefined","undefined");if(i(lt)){var Ot="'"+JSON.stringify(lt).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ft.stylize(Ot,"string")}if(L(lt))return ft.stylize(""+lt,"number");if($(lt))return ft.stylize(""+lt,"boolean");if(I(lt))return ft.stylize("null","null")}(h,_);if(St)return St;var N=Object.keys(_),Z=function(ft){var lt={};return ft.forEach(function(Ot,kt){lt[Ot]=!0}),lt}(N);if(h.showHidden&&(N=Object.getOwnPropertyNames(_)),nt(_)&&(N.indexOf("message")>=0||N.indexOf("description")>=0))return x(_);if(N.length===0){if(at(_)){var st=_.name?": "+_.name:"";return h.stylize("[Function"+st+"]","special")}if(g(_))return h.stylize(RegExp.prototype.toString.call(_),"regexp");if(G(_))return h.stylize(Date.prototype.toString.call(_),"date");if(nt(_))return x(_)}var jt,xt="",Ft=!1,ee=["{","}"];return F(_)&&(Ft=!0,ee=["[","]"]),at(_)&&(xt=" [Function"+(_.name?": "+_.name:"")+"]"),g(_)&&(xt=" "+RegExp.prototype.toString.call(_)),G(_)&&(xt=" "+Date.prototype.toUTCString.call(_)),nt(_)&&(xt=" "+x(_)),N.length!==0||Ft&&_.length!=0?z<0?g(_)?h.stylize(RegExp.prototype.toString.call(_),"regexp"):h.stylize("[Object]","special"):(h.seen.push(_),jt=Ft?function(ft,lt,Ot,kt,Rt){for(var Kt=[],Lt=0,Tt=lt.length;Lt<Tt;++Lt)Se(lt,String(Lt))?Kt.push(v(ft,lt,Ot,kt,String(Lt),!0)):Kt.push("");return Rt.forEach(function(he){he.match(/^\d+$/)||Kt.push(v(ft,lt,Ot,kt,he,!0))}),Kt}(h,_,z,Z,N):N.map(function(ft){return v(h,_,z,Z,ft,Ft)}),h.seen.pop(),function(ft,lt,Ot){return ft.reduce(function(kt,Rt){return Rt.indexOf(`
`)>=0,kt+Rt.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?Ot[0]+(lt===""?"":lt+`
 `)+" "+ft.join(`,
  `)+" "+Ot[1]:Ot[0]+lt+" "+ft.join(", ")+" "+Ot[1]}(jt,xt,ee)):ee[0]+xt+ee[1]}function x(h){return"["+Error.prototype.toString.call(h)+"]"}function v(h,_,z,tt,St,N){var Z,st,jt;if((jt=Object.getOwnPropertyDescriptor(_,St)||{value:_[St]}).get?st=jt.set?h.stylize("[Getter/Setter]","special"):h.stylize("[Getter]","special"):jt.set&&(st=h.stylize("[Setter]","special")),Se(tt,St)||(Z="["+St+"]"),st||(h.seen.indexOf(jt.value)<0?(st=I(z)?f(h,jt.value,null):f(h,jt.value,z-1)).indexOf(`
`)>-1&&(st=N?st.split(`
`).map(function(xt){return"  "+xt}).join(`
`).substr(2):`
`+st.split(`
`).map(function(xt){return"   "+xt}).join(`
`)):st=h.stylize("[Circular]","special")),l(Z)){if(N&&St.match(/^\d+$/))return st;(Z=JSON.stringify(""+St)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(Z=Z.substr(1,Z.length-2),Z=h.stylize(Z,"name")):(Z=Z.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),Z=h.stylize(Z,"string"))}return Z+": "+st}function F(h){return Array.isArray(h)}function $(h){return typeof h=="boolean"}function I(h){return h===null}function L(h){return typeof h=="number"}function i(h){return typeof h=="string"}function l(h){return h===void 0}function g(h){return y(h)&&ht(h)==="[object RegExp]"}function y(h){return typeof h=="object"&&h!==null}function G(h){return y(h)&&ht(h)==="[object Date]"}function nt(h){return y(h)&&(ht(h)==="[object Error]"||h instanceof Error)}function at(h){return typeof h=="function"}function ht(h){return Object.prototype.toString.call(h)}function wt(h){return h<10?"0"+h.toString(10):h.toString(10)}d.debuglog=function(h){if(l(U)&&(U=T.env.NODE_DEBUG||""),h=h.toUpperCase(),!Y[h])if(new RegExp("\\b"+h+"\\b","i").test(U)){var _=T.pid;Y[h]=function(){var z=d.format.apply(d,arguments);console.error("%s %d: %s",h,_,z)}}else Y[h]=function(){};return Y[h]},d.inspect=b,b.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},b.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},d.isArray=F,d.isBoolean=$,d.isNull=I,d.isNullOrUndefined=function(h){return h==null},d.isNumber=L,d.isString=i,d.isSymbol=function(h){return typeof h=="symbol"},d.isUndefined=l,d.isRegExp=g,d.isObject=y,d.isDate=G,d.isError=nt,d.isFunction=at,d.isPrimitive=function(h){return h===null||typeof h=="boolean"||typeof h=="number"||typeof h=="string"||typeof h=="symbol"||h===void 0},d.isBuffer=S(384);var At=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function bt(){var h=new Date,_=[wt(h.getHours()),wt(h.getMinutes()),wt(h.getSeconds())].join(":");return[h.getDate(),At[h.getMonth()],_].join(" ")}function Se(h,_){return Object.prototype.hasOwnProperty.call(h,_)}d.log=function(){console.log("%s - %s",bt(),d.format.apply(d,arguments))},d.inherits=S(717),d._extend=function(h,_){if(!_||!y(_))return h;for(var z=Object.keys(_),tt=z.length;tt--;)h[z[tt]]=_[z[tt]];return h}}},et={};function H(D){var d=et[D];if(d!==void 0)return d.exports;var S=et[D]={exports:{}};return X[D].call(S.exports,S,S.exports,H),S.exports}H.n=D=>{var d=D&&D.__esModule?()=>D.default:()=>D;return H.d(d,{a:d}),d},H.d=(D,d)=>{for(var S in d)H.o(d,S)&&!H.o(D,S)&&Object.defineProperty(D,S,{enumerable:!0,get:d[S]})},H.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),H.o=(D,d)=>Object.prototype.hasOwnProperty.call(D,d),H.r=D=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(D,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(D,"__esModule",{value:!0})};var K={};return(()=>{H.r(K),H.d(K,{LSPluginUser:()=>Yn,setupPluginUserInstance:()=>Or});var D=H(520),d=(H(856),H(996)),S=H.n(d),T=function(){return T=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},T.apply(this,arguments)};function k(e){return e.toLowerCase()}var U=[/([a-z0-9])([A-Z])/g,/([A-Z])([A-Z][a-z])/g],Y=/[^A-Z0-9]+/gi;function b(e,t,n){return t instanceof RegExp?e.replace(t,n):t.reduce(function(r,s){return r.replace(s,n)},e)}function p(e,t){return t===void 0&&(t={}),function(n,r){r===void 0&&(r={});for(var s=r.splitRegexp,a=s===void 0?U:s,c=r.stripRegexp,m=c===void 0?Y:c,O=r.transform,P=O===void 0?k:O,B=r.delimiter,R=B===void 0?" ":B,W=b(b(n,a,"$1\0$2"),m,"\0"),Q=0,J=W.length;W.charAt(Q)==="\0";)Q++;for(;W.charAt(J-1)==="\0";)J--;return W.slice(Q,J).split("\0").map(P).join(R)}(e,T({delimiter:"."},t))}var w=H(729),f=H.n(w);function x(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const v=navigator.platform.toLowerCase()==="win32"?D.win32:D.posix,F=function(e,t){return t===void 0&&(t={}),p(e,T({delimiter:"_"},t))};class $ extends f(){constructor(t,n){super(),x(this,"_tag",void 0),x(this,"_opts",void 0),x(this,"_logs",[]),this._tag=t,this._opts=n}write(t,n,r){var s;n!=null&&n.length&&n[n.length-1]===!0&&(r=!0,n.pop());const a=n.reduce((m,O)=>(O&&O instanceof Error?m+=`${O.message} ${O.stack}`:m+=O.toString(),m),`[${this._tag}][${new Date().toLocaleTimeString()}] `);var c;this._logs.push([t,a]),(r||(s=this._opts)!==null&&s!==void 0&&s.console)&&((c=console)===null||c===void 0||c[t==="ERROR"?"error":"debug"](`${t}: ${a}`)),this.emit("change")}clear(){this._logs=[],this.emit("change")}info(...t){this.write("INFO",t)}error(...t){this.write("ERROR",t)}warn(...t){this.write("WARN",t)}setTag(t){this._tag=t}toJSON(){return this._logs}}function I(e,...t){try{const n=new URL(e);if(!n.origin)throw new Error(null);const r=v.join(e.substr(n.origin.length),...t);return n.origin+r}catch{return v.join(e,...t)}}function L(e,t){let n,r,s=!1;const a=m=>O=>{e&&clearTimeout(e),m(O),s=!0},c=new Promise((m,O)=>{n=a(m),r=a(O),e&&(e=setTimeout(()=>r(new Error(`[deferred timeout] ${t}`)),e))});return{created:Date.now(),setTag:m=>t=m,resolve:n,reject:r,promise:c,get settled(){return s}}}const i=new Map;window.__injectedUIEffects=i;var l=H(227),g=H.n(l);function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const G="application/x-postmate-v1+json";let nt=0;const at={handshake:1,"handshake-reply":1,call:1,emit:1,reply:1,request:1},ht=(e,t)=>(typeof t!="string"||e.origin===t)&&!!e.data&&(typeof e.data!="object"||"postmate"in e.data)&&e.data.type===G&&!!at[e.data.postmate];class wt{constructor(t){y(this,"parent",void 0),y(this,"frame",void 0),y(this,"child",void 0),y(this,"events",{}),y(this,"childOrigin",void 0),y(this,"listener",void 0),this.parent=t.parent,this.frame=t.frame,this.child=t.child,this.childOrigin=t.childOrigin,this.listener=n=>{if(!ht(n,this.childOrigin))return!1;const{data:r,name:s}=((n||{}).data||{}).value||{};n.data.postmate==="emit"&&s in this.events&&this.events[s].forEach(a=>{a.call(this,r)})},this.parent.addEventListener("message",this.listener,!1)}get(t,...n){return new Promise((r,s)=>{const a=++nt,c=m=>{m.data.uid===a&&m.data.postmate==="reply"&&(this.parent.removeEventListener("message",c,!1),m.data.error?s(m.data.error):r(m.data.value))};this.parent.addEventListener("message",c,!1),this.child.postMessage({postmate:"request",type:G,property:t,args:n,uid:a},this.childOrigin)})}call(t,n){this.child.postMessage({postmate:"call",type:G,property:t,data:n},this.childOrigin)}on(t,n){this.events[t]||(this.events[t]=[]),this.events[t].push(n)}destroy(){window.removeEventListener("message",this.listener,!1),this.frame.parentNode.removeChild(this.frame)}}class At{constructor(t){y(this,"model",void 0),y(this,"parent",void 0),y(this,"parentOrigin",void 0),y(this,"child",void 0),this.model=t.model,this.parent=t.parent,this.parentOrigin=t.parentOrigin,this.child=t.child,this.child.addEventListener("message",n=>{if(!ht(n,this.parentOrigin))return;const{property:r,uid:s,data:a,args:c}=n.data;n.data.postmate!=="call"?((m,O,P)=>{const B=typeof m[O]=="function"?m[O].apply(null,P):m[O];return Promise.resolve(B)})(this.model,r,c).then(m=>{n.source.postMessage({property:r,postmate:"reply",type:G,uid:s,value:m},n.origin)}).catch(m=>{n.source.postMessage({property:r,postmate:"reply",type:G,uid:s,error:m},n.origin)}):r in this.model&&typeof this.model[r]=="function"&&this.model[r](a)})}emit(t,n){this.parent.postMessage({postmate:"emit",type:G,value:{name:t,data:n}},this.parentOrigin)}}class bt{constructor(t){y(this,"container",void 0),y(this,"parent",void 0),y(this,"frame",void 0),y(this,"child",void 0),y(this,"childOrigin",void 0),y(this,"url",void 0),y(this,"model",void 0),this.container=t.container,this.url=t.url,this.parent=window,this.frame=document.createElement("iframe"),t.id&&(this.frame.id=t.id),t.name&&(this.frame.name=t.name),this.frame.classList.add.apply(this.frame.classList,t.classListArray||[]),this.container.appendChild(this.frame),this.child=this.frame.contentWindow,this.model=t.model||{}}sendHandshake(t){const n=(a=>{const c=document.createElement("a");c.href=a;const m=c.protocol.length>4?c.protocol:window.location.protocol,O=c.host.length?c.port==="80"||c.port==="443"?c.hostname:c.host:window.location.host;return c.origin||`${m}//${O}`})(t=t||this.url);let r,s=0;return new Promise((a,c)=>{const m=P=>!!ht(P,n)&&(P.data.postmate==="handshake-reply"?(clearInterval(r),this.parent.removeEventListener("message",m,!1),this.childOrigin=P.origin,a(new wt(this))):c("Failed handshake"));this.parent.addEventListener("message",m,!1);const O=()=>{s++,this.child.postMessage({postmate:"handshake",type:G,model:this.model},n),s===5&&clearInterval(r)};this.frame.addEventListener("load",()=>{O(),r=setInterval(O,500)}),this.frame.src=t})}destroy(){this.frame.parentNode.removeChild(this.frame)}}y(bt,"debug",!1),y(bt,"Model",void 0);class Se{constructor(t){y(this,"child",void 0),y(this,"model",void 0),y(this,"parent",void 0),y(this,"parentOrigin",void 0),this.child=window,this.model=t,this.parent=this.child.parent}sendHandshakeReply(){return new Promise((t,n)=>{const r=s=>{if(s.data.postmate){if(s.data.postmate==="handshake"){this.child.removeEventListener("message",r,!1),s.source.postMessage({postmate:"handshake-reply",type:G},s.origin),this.parentOrigin=s.origin;const a=s.data.model;return a&&Object.keys(a).forEach(c=>{this.model[c]=a[c]}),t(new At(this))}return n("Handshake Reply Failed")}};this.child.addEventListener("message",r,!1)})}}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const{importHTML:_,createSandboxContainer:z}=window.QSandbox||{};function tt(e,t){return e.startsWith("http")?fetch(e,t):(e=e.replace("file://",""),new Promise(async(n,r)=>{try{const s=await window.apis.doAction(["readFile",e]);n({text:()=>s})}catch(s){console.error(s),r(s)}}))}class St extends f(){constructor(t){super(),h(this,"_pluginLocal",void 0),h(this,"_frame",void 0),h(this,"_root",void 0),h(this,"_loaded",!1),h(this,"_unmountFns",[]),this._pluginLocal=t,t._dispose(()=>{this._unmount()})}async load(){const{name:t,entry:n}=this._pluginLocal.options;if(this.loaded||!n)return;const{template:r,execScripts:s}=await _(n,{fetch:tt});this._mount(r,document.body);const a=z(t,{elementGetter:()=>{var m;return(m=this._root)===null||m===void 0?void 0:m.firstChild}}).instance.proxy;a.__shadow_mode__=!0,a.LSPluginLocal=this._pluginLocal,a.LSPluginShadow=this,a.LSPluginUser=a.logseq=new Yn(this._pluginLocal.toJSON(),this._pluginLocal.caller);const c=await s(a,!0);this._unmountFns.push(c.unmount),this._loaded=!0}_mount(t,n){const r=this._frame=document.createElement("div");r.classList.add("lsp-shadow-sandbox"),r.id=this._pluginLocal.id,this._root=r.attachShadow({mode:"open"}),this._root.innerHTML=`<div>${t}</div>`,n.appendChild(r),this.emit("mounted")}_unmount(){for(const t of this._unmountFns)t&&t.call(null)}destroy(){var t,n;(t=this.frame)===null||t===void 0||(n=t.parentNode)===null||n===void 0||n.removeChild(this.frame)}get loaded(){return this._loaded}get document(){var t;return(t=this._root)===null||t===void 0?void 0:t.firstChild}get frame(){return this._frame}}function N(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Z=g()("LSPlugin:caller"),st="#await#response#",jt="#lspmsg#",xt="#lspmsg#error#",Ft=e=>`#lspmsg#${e}`;class ee extends f(){constructor(t){super(),N(this,"_pluginLocal",void 0),N(this,"_connected",!1),N(this,"_parent",void 0),N(this,"_child",void 0),N(this,"_shadow",void 0),N(this,"_status",void 0),N(this,"_userModel",{}),N(this,"_call",void 0),N(this,"_callUserModel",void 0),N(this,"_debugTag",""),this._pluginLocal=t,t&&(this._debugTag=t.debugTag)}async connectToChild(){if(this._connected)return;const{shadow:t}=this._pluginLocal;t?await this._setupShadowSandbox():await this._setupIframeSandbox()}async connectToParent(t={}){if(this._connected)return;const n=this,r=this._pluginLocal!=null;let s=0;const a=new Map,c=L(6e4),m=this._extendUserModel({"#lspmsg#ready#":async B=>{m[Ft(B==null?void 0:B.pid)]=({type:R,payload:W})=>{Z(`[host (_call) -> *user] ${this._debugTag}`,R,W),n.emit(R,W)},await c.resolve()},"#lspmsg#beforeunload#":async B=>{const R=L(1e4);n.emit("beforeunload",Object.assign({actor:R},B)),await R.promise},"#lspmsg#settings#":async({type:B,payload:R})=>{n.emit("settings:changed",R)},[jt]:async({ns:B,type:R,payload:W})=>{Z(`[host (async) -> *user] ${this._debugTag} ns=${B} type=${R}`,W),B&&B.startsWith("hook")?n.emit(`${B}:${R}`,W):n.emit(R,W)},"#lspmsg#reply#":({_sync:B,result:R})=>{if(Z(`[sync host -> *user] #${B}`,R),a.has(B)){const W=a.get(B);W&&(R!=null&&R.hasOwnProperty(xt)?W.reject(R[xt]):W.resolve(R),a.delete(B))}},...t});var O;if(r)return await c.promise,JSON.parse(JSON.stringify((O=this._pluginLocal)===null||O===void 0?void 0:O.toJSON()));const P=new Se(m).sendHandshakeReply();return this._status="pending",await P.then(B=>{this._child=B,this._connected=!0,this._call=async(R,W={},Q)=>{if(Q){const J=++s;a.set(J,Q),W._sync=J,Q.setTag(`async call #${J}`),Z(`async call #${J}`)}return B.emit(Ft(m.baseInfo.id),{type:R,payload:W}),Q==null?void 0:Q.promise},this._callUserModel=async(R,W)=>{try{m[R](W)}catch{Z(`[model method] #${R} not existed`)}},setInterval(()=>{if(a.size>100)for(const[R,W]of a)W.settled&&a.delete(R)},18e5)}).finally(()=>{this._status=void 0}),await c.promise,m.baseInfo}async call(t,n={}){var r;return(r=this._call)===null||r===void 0?void 0:r.call(this,t,n)}async callAsync(t,n={}){var r;const s=L(1e4);return(r=this._call)===null||r===void 0?void 0:r.call(this,t,n,s)}async callUserModel(t,...n){var r;return(r=this._callUserModel)===null||r===void 0?void 0:r.apply(this,[t,...n])}async callUserModelAsync(t,...n){var r;return t=`${st}${t}`,(r=this._callUserModel)===null||r===void 0?void 0:r.apply(this,[t,...n])}async _setupIframeSandbox(){const t=this._pluginLocal,n=t.id,r=`${n}_lsp_main`,s=new URL(t.options.entry);s.searchParams.set("__v__",t.options.version);const a=document.querySelector(`#${r}`);a&&a.parentElement.removeChild(a);const c=document.createElement("div");c.classList.add("lsp-iframe-sandbox-container"),c.id=r,c.dataset.pid=n;try{var m;const R=(m=await this._pluginLocal._loadLayoutsData())===null||m===void 0?void 0:m.$$0;if(R){c.dataset.inited_layout="true";let{width:W,height:Q,left:J,top:it,vw:ct,vh:vt}=R;J=Math.max(J,0),J=typeof ct=="number"?`${Math.min(100*J/ct,99)}%`:`${J}px`,it=Math.max(it,45),it=typeof vt=="number"?`${Math.min(100*it/vt,99)}%`:`${it}px`,Object.assign(c.style,{width:W+"px",height:Q+"px",left:J,top:it})}}catch(R){console.error("[Restore Layout Error]",R)}document.body.appendChild(c);const O=new bt({id:n+"_iframe",container:c,url:s.href,classListArray:["lsp-iframe-sandbox"],model:{baseInfo:JSON.parse(JSON.stringify(t.toJSON()))}});let P,B=O.sendHandshake();return this._status="pending",new Promise((R,W)=>{P=setTimeout(()=>{W(new Error("handshake Timeout")),O.destroy()},4e3),B.then(Q=>{this._parent=Q,this._connected=!0,this.emit("connected"),Q.on(Ft(t.id),({type:J,payload:it})=>{var ct,vt;Z("[user -> *host] ",J,it),(ct=this._pluginLocal)===null||ct===void 0||ct.emit(J,it||{}),(vt=this._pluginLocal)===null||vt===void 0||vt.caller.emit(J,it||{})}),this._call=async(...J)=>{await Q.call(Ft(t.id),{type:J[0],payload:Object.assign(J[1]||{},{$$pid:t.id})})},this._callUserModel=async(J,...it)=>{if(J.startsWith(st))return await Q.get(J.replace(st,""),...it);Q.call(J,it==null?void 0:it[0])},R(null)}).catch(Q=>{W(Q)}).finally(()=>{clearTimeout(P)})}).catch(R=>{throw Z("[iframe sandbox] error",R),R}).finally(()=>{this._status=void 0})}async _setupShadowSandbox(){const t=this._pluginLocal,n=this._shadow=new St(t);try{this._status="pending",await n.load(),this._connected=!0,this.emit("connected"),this._call=async(r,s={},a)=>{var c;return a&&(s.actor=a),(c=this._pluginLocal)===null||c===void 0||c.emit(r,Object.assign(s,{$$pid:t.id})),a==null?void 0:a.promise},this._callUserModel=async(...r)=>{var s;let a=r[0];(s=a)!==null&&s!==void 0&&s.startsWith(st)&&(a=a.replace(st,""));const c=r[1]||{},m=this._userModel[a];typeof m=="function"&&await m.call(null,c)}}catch(r){throw Z("[shadow sandbox] error",r),r}finally{this._status=void 0}}_extendUserModel(t){return Object.assign(this._userModel,t)}_getSandboxIframeContainer(){var t;return(t=this._parent)===null||t===void 0?void 0:t.frame.parentNode}_getSandboxShadowContainer(){var t;return(t=this._shadow)===null||t===void 0?void 0:t.frame.parentNode}_getSandboxIframeRoot(){var t;return(t=this._parent)===null||t===void 0?void 0:t.frame}_getSandboxShadowRoot(){var t;return(t=this._shadow)===null||t===void 0?void 0:t.frame}set debugTag(t){this._debugTag=t}async destroy(){var t;let n=null;this._parent&&(n=this._getSandboxIframeContainer(),await this._parent.destroy()),this._shadow&&(n=this._getSandboxShadowContainer(),this._shadow.destroy()),(t=n)===null||t===void 0||t.parentNode.removeChild(n)}}function ft(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class lt{constructor(t,n){ft(this,"ctx",void 0),ft(this,"opts",void 0),this.ctx=t,this.opts=n}get ctxId(){return this.ctx.baseInfo.id}setItem(t,n){var r;return this.ctx.caller.callAsync("api:call",{method:"write-plugin-storage-file",args:[this.ctxId,t,n,(r=this.opts)===null||r===void 0?void 0:r.assets]})}getItem(t){var n;return this.ctx.caller.callAsync("api:call",{method:"read-plugin-storage-file",args:[this.ctxId,t,(n=this.opts)===null||n===void 0?void 0:n.assets]})}removeItem(t){var n;return this.ctx.caller.call("api:call",{method:"unlink-plugin-storage-file",args:[this.ctxId,t,(n=this.opts)===null||n===void 0?void 0:n.assets]})}allKeys(){var t;return this.ctx.caller.callAsync("api:call",{method:"list-plugin-storage-files",args:[this.ctxId,(t=this.opts)===null||t===void 0?void 0:t.assets]})}clear(){var t;return this.ctx.caller.call("api:call",{method:"clear-plugin-storage-files",args:[this.ctxId,(t=this.opts)===null||t===void 0?void 0:t.assets]})}hasItem(t){var n;return this.ctx.caller.callAsync("api:call",{method:"exist-plugin-storage-file",args:[this.ctxId,t,(n=this.opts)===null||n===void 0?void 0:n.assets]})}}class Ot{constructor(t){var n,r,s;s=void 0,(r="ctx")in(n=this)?Object.defineProperty(n,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[r]=s,this.ctx=t}get React(){return this.ensureHostScope().React}get ReactDOM(){return this.ensureHostScope().ReactDOM}get pluginLocal(){return this.ensureHostScope().LSPluginCore.ensurePlugin(this.ctx.baseInfo.id)}invokeExperMethod(t,...n){var r,s;const a=this.ensureHostScope();return t=(r=F(t))===null||r===void 0?void 0:r.toLowerCase(),(s=a.logseq.api["exper_"+t])===null||s===void 0?void 0:s.apply(a,n)}async loadScripts(...t){(t=t.map(n=>n!=null&&n.startsWith("http")?n:this.ctx.resolveResourceFullUrl(n))).unshift(this.ctx.baseInfo.id),await this.invokeExperMethod("loadScripts",...t)}registerFencedCodeRenderer(t,n){return this.ensureHostScope().logseq.api.exper_register_fenced_code_renderer(this.ctx.baseInfo.id,t,n)}registerExtensionsEnhancer(t,n){const r=this.ensureHostScope();return t==="katex"&&r.katex&&n(r.katex).catch(console.error),r.logseq.api.exper_register_extensions_enhancer(this.ctx.baseInfo.id,t,n)}ensureHostScope(){if(window===top)throw new Error("Can not access host scope!");return top}}function kt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Rt=e=>`task_callback_${e}`;class Kt{constructor(t,n,r={}){kt(this,"_client",void 0),kt(this,"_requestId",void 0),kt(this,"_requestOptions",void 0),kt(this,"_promise",void 0),kt(this,"_aborted",!1),this._client=t,this._requestId=n,this._requestOptions=r,this._promise=new Promise((m,O)=>{if(!this._requestId)return O(null);this._client.once(Rt(this._requestId),P=>{P&&P instanceof Error?O(P):m(P)})});const{success:s,fail:a,final:c}=this._requestOptions;this._promise.then(m=>{s==null||s(m)}).catch(m=>{a==null||a(m)}).finally(()=>{c==null||c()})}abort(){this._requestOptions.abortable&&!this._aborted&&(this._client.ctx._execCallableAPI("http_request_abort",this._requestId),this._aborted=!0)}get promise(){return this._promise}get client(){return this._client}get requestId(){return this._requestId}}class Lt extends w.EventEmitter{constructor(t){super(),kt(this,"_ctx",void 0),this._ctx=t,this.ctx.caller.on("#lsp#request#callback",n=>{const r=n==null?void 0:n.requestId;r&&this.emit(Rt(r),n==null?void 0:n.payload)})}static createRequestTask(t,n,r){return new Kt(t,n,r)}async _request(t){const n=this.ctx.baseInfo.id,{success:r,fail:s,final:a,...c}=t,m=this.ctx.Experiments.invokeExperMethod("request",n,c),O=Lt.createRequestTask(this.ctx.Request,m,t);return c.abortable?O:O.promise}get ctx(){return this._ctx}}const Tt=Array.isArray,he=typeof Cn=="object"&&Cn&&Cn.Object===Object&&Cn;var En=typeof self=="object"&&self&&self.Object===Object&&self;const Ut=he||En||Function("return this")(),Wt=Ut.Symbol;var Qe=Object.prototype,jn=Qe.hasOwnProperty,kn=Qe.toString,pe=Wt?Wt.toStringTag:void 0;const Tn=function(e){var t=jn.call(e,pe),n=e[pe];try{e[pe]=void 0;var r=!0}catch{}var s=kn.call(e);return r&&(t?e[pe]=n:delete e[pe]),s};var Xe=Object.prototype.toString;const A=function(e){return Xe.call(e)};var M=Wt?Wt.toStringTag:void 0;const q=function(e){return e==null?e===void 0?"[object Undefined]":"[object Null]":M&&M in Object(e)?Tn(e):A(e)},V=function(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")},pt=function(e){if(!V(e))return!1;var t=q(e);return t=="[object Function]"||t=="[object GeneratorFunction]"||t=="[object AsyncFunction]"||t=="[object Proxy]"},Pt=Ut["__core-js_shared__"];var Gt,ne=(Gt=/[^.]+$/.exec(Pt&&Pt.keys&&Pt.keys.IE_PROTO||""))?"Symbol(src)_1."+Gt:"";const Pe=function(e){return!!ne&&ne in e};var tn=Function.prototype.toString;const Yt=function(e){if(e!=null){try{return tn.call(e)}catch{}try{return e+""}catch{}}return""};var In=/^\[object .+?Constructor\]$/,Fn=Function.prototype,Ln=Object.prototype,Oe=Fn.toString,Mn=Ln.hasOwnProperty,Nn=RegExp("^"+Oe.call(Mn).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const Rn=function(e){return!(!V(e)||Pe(e))&&(pt(e)?Nn:In).test(Yt(e))},De=function(e,t){return e==null?void 0:e[t]},Dt=function(e,t){var n=De(e,t);return Rn(n)?n:void 0},$t=function(){try{var e=Dt(Object,"defineProperty");return e({},"",{}),e}catch{}}(),en=function(e,t,n){t=="__proto__"&&$t?$t(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n},Ee=function(e){return function(t,n,r){for(var s=-1,a=Object(t),c=r(t),m=c.length;m--;){var O=c[++s];if(n(a[O],O,a)===!1)break}return t}}(),$e=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r},re=function(e){return e!=null&&typeof e=="object"},nn=function(e){return re(e)&&q(e)=="[object Arguments]"};var rn=Object.prototype,Un=rn.hasOwnProperty,on=rn.propertyIsEnumerable;const Mt=nn(function(){return arguments}())?nn:function(e){return re(e)&&Un.call(e,"callee")&&!on.call(e,"callee")},me=function(){return!1};var Jt=E&&!E.nodeType&&E,je=Jt&&!0&&u&&!u.nodeType&&u,ke=je&&je.exports===Jt?Ut.Buffer:void 0;const ze=(ke?ke.isBuffer:void 0)||me;var Pn=/^(?:0|[1-9]\d*)$/;const sn=function(e,t){var n=typeof e;return!!(t=t??9007199254740991)&&(n=="number"||n!="symbol"&&Pn.test(e))&&e>-1&&e%1==0&&e<t},Te=function(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=9007199254740991};var rt={};rt["[object Float32Array]"]=rt["[object Float64Array]"]=rt["[object Int8Array]"]=rt["[object Int16Array]"]=rt["[object Int32Array]"]=rt["[object Uint8Array]"]=rt["[object Uint8ClampedArray]"]=rt["[object Uint16Array]"]=rt["[object Uint32Array]"]=!0,rt["[object Arguments]"]=rt["[object Array]"]=rt["[object ArrayBuffer]"]=rt["[object Boolean]"]=rt["[object DataView]"]=rt["[object Date]"]=rt["[object Error]"]=rt["[object Function]"]=rt["[object Map]"]=rt["[object Number]"]=rt["[object Object]"]=rt["[object RegExp]"]=rt["[object Set]"]=rt["[object String]"]=rt["[object WeakMap]"]=!1;const mt=function(e){return re(e)&&Te(e.length)&&!!rt[q(e)]},an=function(e){return function(t){return e(t)}};var gt=E&&!E.nodeType&&E,oe=gt&&!0&&u&&!u.nodeType&&u,ut=oe&&oe.exports===gt&&he.process,ie=function(){try{var e=oe&&oe.require&&oe.require("util").types;return e||ut&&ut.binding&&ut.binding("util")}catch{}}(),Ie=ie&&ie.isTypedArray;const Be=Ie?an(Ie):mt;var He=Object.prototype.hasOwnProperty;const cn=function(e,t){var n=Tt(e),r=!n&&Mt(e),s=!n&&!r&&ze(e),a=!n&&!r&&!s&&Be(e),c=n||r||s||a,m=c?$e(e.length,String):[],O=m.length;for(var P in e)!He.call(e,P)||c&&(P=="length"||s&&(P=="offset"||P=="parent")||a&&(P=="buffer"||P=="byteLength"||P=="byteOffset")||sn(P,O))||m.push(P);return m};var se=Object.prototype;const Qt=function(e){var t=e&&e.constructor;return e===(typeof t=="function"&&t.prototype||se)},qe=function(e,t){return function(n){return e(t(n))}}(Object.keys,Object);var We=Object.prototype.hasOwnProperty;const ae=function(e){if(!Qt(e))return qe(e);var t=[];for(var n in Object(e))We.call(e,n)&&n!="constructor"&&t.push(n);return t},Fe=function(e){return e!=null&&Te(e.length)&&!pt(e)},ce=function(e){return Fe(e)?cn(e):ae(e)},ln=function(e,t){return e&&Ee(e,t,ce)},Ge=function(){this.__data__=[],this.size=0},le=function(e,t){return e===t||e!=e&&t!=t},zt=function(e,t){for(var n=e.length;n--;)if(le(e[n][0],t))return n;return-1};var ue=Array.prototype.splice;const un=function(e){var t=this.__data__,n=zt(t,e);return!(n<0)&&(n==t.length-1?t.pop():ue.call(t,n,1),--this.size,!0)},fn=function(e){var t=this.__data__,n=zt(t,e);return n<0?void 0:t[n][1]},dn=function(e){return zt(this.__data__,e)>-1},Je=function(e,t){var n=this.__data__,r=zt(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this};function Xt(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Xt.prototype.clear=Ge,Xt.prototype.delete=un,Xt.prototype.get=fn,Xt.prototype.has=dn,Xt.prototype.set=Je;const fe=Xt,Ze=function(){this.__data__=new fe,this.size=0},Zt=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},Le=function(e){return this.__data__.get(e)},hn=function(e){return this.__data__.has(e)},ge=Dt(Ut,"Map"),ye=Dt(Object,"create"),de=function(){this.__data__=ye?ye(null):{},this.size=0},Dn=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t};var pn=Object.prototype.hasOwnProperty;const Ve=function(e){var t=this.__data__;if(ye){var n=t[e];return n==="__lodash_hash_undefined__"?void 0:n}return pn.call(t,e)?t[e]:void 0};var mn=Object.prototype.hasOwnProperty;const gn=function(e){var t=this.__data__;return ye?t[e]!==void 0:mn.call(t,e)},$n=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=ye&&t===void 0?"__lodash_hash_undefined__":t,this};function Bt(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Bt.prototype.clear=de,Bt.prototype.delete=Dn,Bt.prototype.get=Ve,Bt.prototype.has=gn,Bt.prototype.set=$n;const Me=Bt,zn=function(){this.size=0,this.__data__={hash:new Me,map:new(ge||fe),string:new Me}},Ht=function(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null},ve=function(e,t){var n=e.__data__;return Ht(t)?n[typeof t=="string"?"string":"hash"]:n.map},yn=function(e){var t=ve(this,e).delete(e);return this.size-=t?1:0,t},vn=function(e){return ve(this,e).get(e)},Bn=function(e){return ve(this,e).has(e)},be=function(e,t){var n=ve(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};function Et(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Et.prototype.clear=zn,Et.prototype.delete=yn,Et.prototype.get=vn,Et.prototype.has=Bn,Et.prototype.set=be;const _e=Et,bn=function(e,t){var n=this.__data__;if(n instanceof fe){var r=n.__data__;if(!ge||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new _e(r)}return n.set(e,t),this.size=n.size,this};function te(e){var t=this.__data__=new fe(e);this.size=t.size}te.prototype.clear=Ze,te.prototype.delete=Zt,te.prototype.get=Le,te.prototype.has=hn,te.prototype.set=bn;const we=te,Hn=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},o=function(e){return this.__data__.has(e)};function j(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new _e;++t<n;)this.add(e[t])}j.prototype.add=j.prototype.push=Hn,j.prototype.has=o;const C=j,ot=function(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1},dt=function(e,t){return e.has(t)},_t=function(e,t,n,r,s,a){var c=1&n,m=e.length,O=t.length;if(m!=O&&!(c&&O>m))return!1;var P=a.get(e),B=a.get(t);if(P&&B)return P==t&&B==e;var R=-1,W=!0,Q=2&n?new C:void 0;for(a.set(e,t),a.set(t,e);++R<m;){var J=e[R],it=t[R];if(r)var ct=c?r(it,J,R,t,e,a):r(J,it,R,e,t,a);if(ct!==void 0){if(ct)continue;W=!1;break}if(Q){if(!ot(t,function(vt,Nt){if(!dt(Q,Nt)&&(J===vt||s(J,vt,n,r,a)))return Q.push(Nt)})){W=!1;break}}else if(J!==it&&!s(J,it,n,r,a)){W=!1;break}}return a.delete(e),a.delete(t),W},yt=Ut.Uint8Array,xe=function(e){var t=-1,n=Array(e.size);return e.forEach(function(r,s){n[++t]=[s,r]}),n},Vt=function(e){var t=-1,n=Array(e.size);return e.forEach(function(r){n[++t]=r}),n};var It=Wt?Wt.prototype:void 0,Ke=It?It.valueOf:void 0;const nr=function(e,t,n,r,s,a,c){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!a(new yt(e),new yt(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return le(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var m=xe;case"[object Set]":var O=1&r;if(m||(m=Vt),e.size!=t.size&&!O)return!1;var P=c.get(e);if(P)return P==t;r|=2,c.set(e,t);var B=_t(m(e),m(t),r,s,a,c);return c.delete(e),B;case"[object Symbol]":if(Ke)return Ke.call(e)==Ke.call(t)}return!1},Wr=function(e,t){for(var n=-1,r=t.length,s=e.length;++n<r;)e[s+n]=t[n];return e},Gr=function(e,t,n){var r=t(e);return Tt(e)?r:Wr(r,n(e))},Jr=function(e,t){for(var n=-1,r=e==null?0:e.length,s=0,a=[];++n<r;){var c=e[n];t(c,n,e)&&(a[s++]=c)}return a},Zr=function(){return[]};var Vr=Object.prototype.propertyIsEnumerable,rr=Object.getOwnPropertySymbols;const Kr=rr?function(e){return e==null?[]:(e=Object(e),Jr(rr(e),function(t){return Vr.call(e,t)}))}:Zr,or=function(e){return Gr(e,ce,Kr)};var Yr=Object.prototype.hasOwnProperty;const Qr=function(e,t,n,r,s,a){var c=1&n,m=or(e),O=m.length;if(O!=or(t).length&&!c)return!1;for(var P=O;P--;){var B=m[P];if(!(c?B in t:Yr.call(t,B)))return!1}var R=a.get(e),W=a.get(t);if(R&&W)return R==t&&W==e;var Q=!0;a.set(e,t),a.set(t,e);for(var J=c;++P<O;){var it=e[B=m[P]],ct=t[B];if(r)var vt=c?r(ct,it,B,t,e,a):r(it,ct,B,e,t,a);if(!(vt===void 0?it===ct||s(it,ct,n,r,a):vt)){Q=!1;break}J||(J=B=="constructor")}if(Q&&!J){var Nt=e.constructor,Ae=t.constructor;Nt==Ae||!("constructor"in e)||!("constructor"in t)||typeof Nt=="function"&&Nt instanceof Nt&&typeof Ae=="function"&&Ae instanceof Ae||(Q=!1)}return a.delete(e),a.delete(t),Q},qn=Dt(Ut,"DataView"),Wn=Dt(Ut,"Promise"),Gn=Dt(Ut,"Set"),Jn=Dt(Ut,"WeakMap");var ir="[object Map]",sr="[object Promise]",ar="[object Set]",cr="[object WeakMap]",lr="[object DataView]",Xr=Yt(qn),to=Yt(ge),eo=Yt(Wn),no=Yt(Gn),ro=Yt(Jn),Ce=q;(qn&&Ce(new qn(new ArrayBuffer(1)))!=lr||ge&&Ce(new ge)!=ir||Wn&&Ce(Wn.resolve())!=sr||Gn&&Ce(new Gn)!=ar||Jn&&Ce(new Jn)!=cr)&&(Ce=function(e){var t=q(e),n=t=="[object Object]"?e.constructor:void 0,r=n?Yt(n):"";if(r)switch(r){case Xr:return lr;case to:return ir;case eo:return sr;case no:return ar;case ro:return cr}return t});const ur=Ce;var fr="[object Arguments]",dr="[object Array]",_n="[object Object]",hr=Object.prototype.hasOwnProperty;const oo=function(e,t,n,r,s,a){var c=Tt(e),m=Tt(t),O=c?dr:ur(e),P=m?dr:ur(t),B=(O=O==fr?_n:O)==_n,R=(P=P==fr?_n:P)==_n,W=O==P;if(W&&ze(e)){if(!ze(t))return!1;c=!0,B=!1}if(W&&!B)return a||(a=new we),c||Be(e)?_t(e,t,n,r,s,a):nr(e,t,O,n,r,s,a);if(!(1&n)){var Q=B&&hr.call(e,"__wrapped__"),J=R&&hr.call(t,"__wrapped__");if(Q||J){var it=Q?e.value():e,ct=J?t.value():t;return a||(a=new we),s(it,ct,n,r,a)}}return!!W&&(a||(a=new we),Qr(e,t,n,r,s,a))},pr=function e(t,n,r,s,a){return t===n||(t==null||n==null||!re(t)&&!re(n)?t!=t&&n!=n:oo(t,n,r,s,e,a))},io=function(e,t,n,r){var s=n.length,a=s;if(e==null)return!a;for(e=Object(e);s--;){var c=n[s];if(c[2]?c[1]!==e[c[0]]:!(c[0]in e))return!1}for(;++s<a;){var m=(c=n[s])[0],O=e[m],P=c[1];if(c[2]){if(O===void 0&&!(m in e))return!1}else{var B=new we,R;if(!(R===void 0?pr(P,O,3,r,B):R))return!1}}return!0},mr=function(e){return e==e&&!V(e)},so=function(e){for(var t=ce(e),n=t.length;n--;){var r=t[n],s=e[r];t[n]=[r,s,mr(s)]}return t},gr=function(e,t){return function(n){return n!=null&&n[e]===t&&(t!==void 0||e in Object(n))}},ao=function(e){var t=so(e);return t.length==1&&t[0][2]?gr(t[0][0],t[0][1]):function(n){return n===e||io(n,e,t)}},Zn=function(e){return typeof e=="symbol"||re(e)&&q(e)=="[object Symbol]"};var co=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,lo=/^\w*$/;const Vn=function(e,t){if(Tt(e))return!1;var n=typeof e;return!(n!="number"&&n!="symbol"&&n!="boolean"&&e!=null&&!Zn(e))||lo.test(e)||!co.test(e)||t!=null&&e in Object(t)};function Kn(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError("Expected a function");var n=function(){var r=arguments,s=t?t.apply(this,r):r[0],a=n.cache;if(a.has(s))return a.get(s);var c=e.apply(this,r);return n.cache=a.set(s,c)||a,c};return n.cache=new(Kn.Cache||_e),n}Kn.Cache=_e;const uo=Kn;var fo=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ho=/\\(\\)?/g;const po=function(e){var t=uo(e,function(r){return n.size===500&&n.clear(),r}),n=t.cache;return t}(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(fo,function(n,r,s,a){t.push(s?a.replace(ho,"$1"):r||n)}),t}),mo=function(e,t){for(var n=-1,r=e==null?0:e.length,s=Array(r);++n<r;)s[n]=t(e[n],n,e);return s};var yr=Wt?Wt.prototype:void 0,vr=yr?yr.toString:void 0;const go=function e(t){if(typeof t=="string")return t;if(Tt(t))return mo(t,e)+"";if(Zn(t))return vr?vr.call(t):"";var n=t+"";return n=="0"&&1/t==-1/0?"-0":n},yo=function(e){return e==null?"":go(e)},br=function(e,t){return Tt(e)?e:Vn(e,t)?[e]:po(yo(e))},wn=function(e){if(typeof e=="string"||Zn(e))return e;var t=e+"";return t=="0"&&1/e==-1/0?"-0":t},_r=function(e,t){for(var n=0,r=(t=br(t,e)).length;e!=null&&n<r;)e=e[wn(t[n++])];return n&&n==r?e:void 0},vo=function(e,t,n){var r=e==null?void 0:_r(e,t);return r===void 0?n:r},bo=function(e,t){return e!=null&&t in Object(e)},_o=function(e,t,n){for(var r=-1,s=(t=br(t,e)).length,a=!1;++r<s;){var c=wn(t[r]);if(!(a=e!=null&&n(e,c)))break;e=e[c]}return a||++r!=s?a:!!(s=e==null?0:e.length)&&Te(s)&&sn(c,s)&&(Tt(e)||Mt(e))},wo=function(e,t){return e!=null&&_o(e,t,bo)},xo=function(e,t){return Vn(e)&&mr(t)?gr(wn(e),t):function(n){var r=vo(n,e);return r===void 0&&r===t?wo(n,e):pr(t,r,3)}},Co=function(e){return e},Ao=function(e){return function(t){return t==null?void 0:t[e]}},So=function(e){return function(t){return _r(t,e)}},Oo=function(e){return Vn(e)?Ao(wn(e)):So(e)},Eo=function(e){return typeof e=="function"?e:e==null?Co:typeof e=="object"?Tt(e)?xo(e[0],e[1]):ao(e):Oo(e)},jo=function(e,t){var n={};return t=Eo(t),ln(e,function(r,s,a){en(n,t(r,s,a),r)}),n};function wr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class ko{constructor(t,n){wr(this,"ctx",void 0),wr(this,"serviceHooks",void 0),this.ctx=t,this.serviceHooks=n,t._execCallableAPI("register-search-service",t.baseInfo.id,n.name,n.options),Object.entries({query:{f:"onQuery",args:["graph","q",!0],reply:!0,transformOutput:r=>(Tt(r==null?void 0:r.blocks)&&(r.blocks=r.blocks.map(s=>s&&jo(s,(a,c)=>`block/${c}`))),r)},rebuildBlocksIndice:{f:"onIndiceInit",args:["graph","blocks"]},transactBlocks:{f:"onBlocksChanged",args:["graph","data"]},truncateBlocks:{f:"onIndiceReset",args:["graph"]},removeDb:{f:"onGraph",args:["graph"]}}).forEach(([r,s])=>{const a=(c=>`service:search:${c}:${n.name}`)(r);t.caller.on(a,async c=>{if(pt(n==null?void 0:n[s.f])){let m=null;try{m=await n[s.f].apply(n,(s.args||[]).map(O=>{if(c){if(O===!0)return c;if(c.hasOwnProperty(O)){const P=c[O];return delete c[O],P}}})),s.transformOutput&&(m=s.transformOutput(m))}catch(O){console.error("[SearchService] ",O),m=O}finally{s.reply&&t.caller.call(`${a}:reply`,m)}}})})}}function qt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const To=Symbol.for("proxy-continue"),Io=g()("LSPlugin:user"),xr=new $("",{console:!0});function Ne(e,t,n){var r;const{key:s,label:a,desc:c,palette:m,keybinding:O,extras:P}=t;if(typeof n!="function")return this.logger.error(`${s||a}: command action should be function.`),!1;const B=function(W){if(typeof W=="string")return W.trim().replace(/\s/g,"_").toLowerCase()}(s);if(!B)return this.logger.error(`${a}: command key is required.`),!1;const R=`SimpleCommandHook${B}${++Sr}`;this.Editor["on"+R](n),(r=this.caller)===null||r===void 0||r.call("api:call",{method:"register-plugin-simple-command",args:[this.baseInfo.id,[{key:B,label:a,type:e,desc:c,keybinding:O,extras:P},["editor/hook",R]],m]})}function Cr(e){return!(typeof(t=e)!="string"||t.length!==36||!/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/gi.test(t))||(xr.error(`#${e} is not a valid UUID string.`),!1);var t}let xn=null,Ar=new Map;const Fo={async getInfo(e){return xn||(xn=await this._execCallableAPIAsync("get-app-info")),typeof e=="string"?xn[e]:xn},registerCommand:Ne,registerSearchService(e){if(Ar.has(e.name))throw new Error(`SearchService: #${e.name} has registered!`);Ar.set(e.name,new ko(this,e))},registerCommandPalette(e,t){const{key:n,label:r,keybinding:s}=e;return Ne.call(this,"$palette$",{key:n,label:r,palette:!0,keybinding:s},t)},registerCommandShortcut(e,t,n={}){typeof e=="string"&&(e={mode:"global",binding:e});const{binding:r}=e,s="$shortcut$",a=n.key||s+F(r==null?void 0:r.toString());return Ne.call(this,s,{...n,key:a,palette:!1,keybinding:e},t)},registerUIItem(e,t){var n;const r=this.baseInfo.id;(n=this.caller)===null||n===void 0||n.call("api:call",{method:"register-plugin-ui-item",args:[r,e,t]})},registerPageMenuItem(e,t){if(typeof t!="function")return!1;const n=e+"_"+this.baseInfo.id,r=e;Ne.call(this,"page-menu-item",{key:n,label:r},t)},onBlockRendererSlotted(e,t){if(!Cr(e))return;const n=this.baseInfo.id,r=`hook:editor:${F(`slot:${e}`)}`;return this.caller.on(r,t),this.App._installPluginHook(n,r),()=>{this.caller.off(r,t),this.App._uninstallPluginHook(n,r)}},invokeExternalPlugin(e,...t){var n;if(!(e=(n=e)===null||n===void 0?void 0:n.trim()))return;let[r,s]=e.split(".");if(!["models","commands"].includes(s==null?void 0:s.toLowerCase()))throw new Error("Type only support '.models' or '.commands' currently.");const a=e.replace(`${r}.${s}.`,"");if(!r||!s||!a)throw new Error(`Illegal type of #${e} to invoke external plugin.`);return this._execCallableAPIAsync("invoke_external_plugin_cmd",r,s.toLowerCase(),a,t)},setFullScreen(e){const t=(...n)=>this._callWin("setFullScreen",...n);e==="toggle"?this._callWin("isFullScreen").then(n=>{n?t():t(!0)}):e?t(!0):t()}};let Sr=0;const Lo={newBlockUUID(){return this._execCallableAPIAsync("new_block_uuid")},registerSlashCommand(e,t){var n;Io("Register slash command #",this.baseInfo.id,e,t),typeof t=="function"&&(t=[["editor/clear-current-slash",!1],["editor/restore-saved-cursor"],["editor/hook",t]]),t=t.map(r=>{const[s,...a]=r;if(s==="editor/hook"){let c=a[0],m=()=>{var P;(P=this.caller)===null||P===void 0||P.callUserModel(c)};typeof c=="function"&&(m=c);const O=`SlashCommandHook${s}${++Sr}`;r[1]=O,this.Editor["on"+O](m)}return r}),(n=this.caller)===null||n===void 0||n.call("api:call",{method:"register-plugin-slash-command",args:[this.baseInfo.id,[e,t]]})},registerBlockContextMenuItem(e,t){if(typeof t!="function")return!1;const n=e+"_"+this.baseInfo.id;Ne.call(this,"block-context-menu-item",{key:n,label:e},t)},registerHighlightContextMenuItem(e,t,n){if(typeof t!="function")return!1;const r=e+"_"+this.baseInfo.id;Ne.call(this,"highlight-context-menu-item",{key:r,label:e,extras:n},t)},scrollToBlockInPage(e,t,n){const r="block-content-"+t;n!=null&&n.replaceState?this.App.replaceState("page",{name:e},{anchor:r}):this.App.pushState("page",{name:e},{anchor:r})}},Mo={onBlockChanged(e,t){if(!Cr(e))return;const n=this.baseInfo.id,r=`hook:db:${F(`block:${e}`)}`,s=({block:a,txData:c,txMeta:m})=>{a.uuid===e&&t(a,c,m)};return this.caller.on(r,s),this.App._installPluginHook(n,r),()=>{this.caller.off(r,s),this.App._uninstallPluginHook(n,r)}},datascriptQuery(e,...t){return t.pop(),t!=null&&t.some(n=>typeof n=="function")?this.Experiments.ensureHostScope().logseq.api.datascript_query(e,...t):this._execCallableAPIAsync("datascript_query",e,...t)}},No={},Ro={},Uo={makeSandboxStorage(){return new lt(this,{assets:!0})}};class Yn extends f(){constructor(t,n){super(),qt(this,"_baseInfo",void 0),qt(this,"_caller",void 0),qt(this,"_version","0.0.17"),qt(this,"_debugTag",""),qt(this,"_settingsSchema",void 0),qt(this,"_connected",!1),qt(this,"_ui",new Map),qt(this,"_mFileStorage",void 0),qt(this,"_mRequest",void 0),qt(this,"_mExperiments",void 0),qt(this,"_beforeunloadCallback",void 0),this._baseInfo=t,this._caller=n,n.on("sys:ui:visible",r=>{r!=null&&r.toggle&&this.toggleMainUI()}),n.on("settings:changed",r=>{const s=Object.assign({},this.settings),a=Object.assign(this._baseInfo.settings,r);this.emit("settings:changed",{...a},s)}),n.on("beforeunload",async r=>{const{actor:s,...a}=r,c=this._beforeunloadCallback;try{c&&await c(a),s==null||s.resolve(null)}catch(m){this.logger.error("[beforeunload] ",m),s==null||s.reject(m)}})}async ready(t,n){var r,s;if(!this._connected)try{var a;typeof t=="function"&&(n=t,t={});let c=await this._caller.connectToParent(t);this._connected=!0,r=this._baseInfo,s=c,c=S()(r,s,{arrayMerge:(m,O)=>O}),this._baseInfo=c,(a=c)!==null&&a!==void 0&&a.id&&(this._debugTag=this._caller.debugTag=`#${c.id} [${c.name}]`,this.logger.setTag(this._debugTag)),this._settingsSchema&&(c.settings=function(m,O){const P=(O||[]).reduce((B,R)=>("default"in R&&(B[R.key]=R.default),B),{});return Object.assign(P,m)}(c.settings,this._settingsSchema),await this.useSettingsSchema(this._settingsSchema));try{await this._execCallableAPIAsync("setSDKMetadata",{version:this._version})}catch(m){console.warn(m)}n&&n.call(this,c)}catch(c){console.error(`${this._debugTag} [Ready Error]`,c)}}ensureConnected(){if(!this._connected)throw new Error("not connected")}beforeunload(t){typeof t=="function"&&(this._beforeunloadCallback=t)}provideModel(t){return this.caller._extendUserModel(t),this}provideTheme(t){return this.caller.call("provider:theme",t),this}provideStyle(t){return this.caller.call("provider:style",t),this}provideUI(t){return this.caller.call("provider:ui",t),this}useSettingsSchema(t){return this.connected&&this.caller.call("settings:schema",{schema:t,isSync:!0}),this._settingsSchema=t,this}updateSettings(t){this.caller.call("settings:update",t)}onSettingsChanged(t){const n="settings:changed";return this.on(n,t),()=>this.off(n,t)}showSettingsUI(){this.caller.call("settings:visible:changed",{visible:!0})}hideSettingsUI(){this.caller.call("settings:visible:changed",{visible:!1})}setMainUIAttrs(t){this.caller.call("main-ui:attrs",t)}setMainUIInlineStyle(t){this.caller.call("main-ui:style",t)}hideMainUI(t){const n={key:0,visible:!1,cursor:t==null?void 0:t.restoreEditingCursor};this.caller.call("main-ui:visible",n),this.emit("ui:visible:changed",n),this._ui.set(n.key,n)}showMainUI(t){const n={key:0,visible:!0,autoFocus:t==null?void 0:t.autoFocus};this.caller.call("main-ui:visible",n),this.emit("ui:visible:changed",n),this._ui.set(n.key,n)}toggleMainUI(){const n=this._ui.get(0);n&&n.visible?this.hideMainUI():this.showMainUI()}get version(){return this._version}get isMainUIVisible(){const t=this._ui.get(0);return!!(t&&t.visible)}get connected(){return this._connected}get baseInfo(){return this._baseInfo}get effect(){return(t=this)&&(((n=t.baseInfo)===null||n===void 0?void 0:n.effect)||!((r=t.baseInfo)!==null&&r!==void 0&&r.iir));var t,n,r}get logger(){return xr}get settings(){var t;return(t=this.baseInfo)===null||t===void 0?void 0:t.settings}get caller(){return this._caller}resolveResourceFullUrl(t){if(this.ensureConnected(),t)return t=t.replace(/^[.\\/]+/,""),I(this._baseInfo.lsr,t)}_makeUserProxy(t,n){const r=this,s=this.caller;return new Proxy(t,{get(a,c,m){const O=a[c];return function(...P){if(O){const R=O.apply(r,P.concat(n));if(R!==To)return R}if(n){const R=c.toString().match(/^(once|off|on)/i);if(R!=null){const W=R[0].toLowerCase(),Q=R.input,J=W==="off",it=r.baseInfo.id;let ct=Q.slice(W.length),vt=P[0],Nt=P[1];typeof vt=="string"&&typeof Nt=="function"&&(vt=vt.replace(/^logseq./,":"),ct=`${ct}${vt}`,vt=Nt,Nt=P[2]),ct=`hook:${n}:${F(ct)}`,s[W](ct,vt);const Ae=()=>{s.off(ct,vt),s.listenerCount(ct)||r.App._uninstallPluginHook(it,ct)};return J?void Ae():(r.App._installPluginHook(it,ct,Nt),Ae)}}let B=c;return["git","ui","assets"].includes(n)&&(B=n+"_"+B),s.callAsync("api:call",{tag:n,method:B,args:P})}}})}_execCallableAPIAsync(t,...n){return this._caller.callAsync("api:call",{method:t,args:n})}_execCallableAPI(t,...n){this._caller.call("api:call",{method:t,args:n})}_callWin(...t){return this._execCallableAPIAsync("_callMainWin",...t)}get App(){return this._makeUserProxy(Fo,"app")}get Editor(){return this._makeUserProxy(Lo,"editor")}get DB(){return this._makeUserProxy(Mo,"db")}get Git(){return this._makeUserProxy(No,"git")}get UI(){return this._makeUserProxy(Ro,"ui")}get Assets(){return this._makeUserProxy(Uo,"assets")}get FileStorage(){let t=this._mFileStorage;return t||(t=this._mFileStorage=new lt(this)),t}get Request(){let t=this._mRequest;return t||(t=this._mRequest=new Lt(this)),t}get Experiments(){let t=this._mExperiments;return t||(t=this._mExperiments=new Ot(this)),t}}function Or(e,t){return new Yn(e,t)}if(window.__LSP__HOST__==null){const e=new ee(null);window.logseq=Or({},e)}})(),K})())})(On,On.exports);On.exports;const Fr="3.7.7",Po=Fr,Ue=typeof Buffer=="function",Er=typeof TextDecoder=="function"?new TextDecoder:void 0,jr=typeof TextEncoder=="function"?new TextEncoder:void 0,Do="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Ye=Array.prototype.slice.call(Do),An=(u=>{let E={};return u.forEach((X,et)=>E[X]=et),E})(Ye),$o=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,Ct=String.fromCharCode.bind(String),kr=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):u=>new Uint8Array(Array.prototype.slice.call(u,0)),Lr=u=>u.replace(/=/g,"").replace(/[+\/]/g,E=>E=="+"?"-":"_"),Mr=u=>u.replace(/[^A-Za-z0-9\+\/]/g,""),Nr=u=>{let E,X,et,H,K="";const D=u.length%3;for(let d=0;d<u.length;){if((X=u.charCodeAt(d++))>255||(et=u.charCodeAt(d++))>255||(H=u.charCodeAt(d++))>255)throw new TypeError("invalid character found");E=X<<16|et<<8|H,K+=Ye[E>>18&63]+Ye[E>>12&63]+Ye[E>>6&63]+Ye[E&63]}return D?K.slice(0,D-3)+"===".substring(D):K},tr=typeof btoa=="function"?u=>btoa(u):Ue?u=>Buffer.from(u,"binary").toString("base64"):Nr,Qn=Ue?u=>Buffer.from(u).toString("base64"):u=>{let X=[];for(let et=0,H=u.length;et<H;et+=4096)X.push(Ct.apply(null,u.subarray(et,et+4096)));return tr(X.join(""))},Sn=(u,E=!1)=>E?Lr(Qn(u)):Qn(u),zo=u=>{if(u.length<2){var E=u.charCodeAt(0);return E<128?u:E<2048?Ct(192|E>>>6)+Ct(128|E&63):Ct(224|E>>>12&15)+Ct(128|E>>>6&63)+Ct(128|E&63)}else{var E=65536+(u.charCodeAt(0)-55296)*1024+(u.charCodeAt(1)-56320);return Ct(240|E>>>18&7)+Ct(128|E>>>12&63)+Ct(128|E>>>6&63)+Ct(128|E&63)}},Bo=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,Rr=u=>u.replace(Bo,zo),Tr=Ue?u=>Buffer.from(u,"utf8").toString("base64"):jr?u=>Qn(jr.encode(u)):u=>tr(Rr(u)),Re=(u,E=!1)=>E?Lr(Tr(u)):Tr(u),Ir=u=>Re(u,!0),Ho=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,qo=u=>{switch(u.length){case 4:var E=(7&u.charCodeAt(0))<<18|(63&u.charCodeAt(1))<<12|(63&u.charCodeAt(2))<<6|63&u.charCodeAt(3),X=E-65536;return Ct((X>>>10)+55296)+Ct((X&1023)+56320);case 3:return Ct((15&u.charCodeAt(0))<<12|(63&u.charCodeAt(1))<<6|63&u.charCodeAt(2));default:return Ct((31&u.charCodeAt(0))<<6|63&u.charCodeAt(1))}},Ur=u=>u.replace(Ho,qo),Pr=u=>{if(u=u.replace(/\s+/g,""),!$o.test(u))throw new TypeError("malformed base64.");u+="==".slice(2-(u.length&3));let E,X="",et,H;for(let K=0;K<u.length;)E=An[u.charAt(K++)]<<18|An[u.charAt(K++)]<<12|(et=An[u.charAt(K++)])<<6|(H=An[u.charAt(K++)]),X+=et===64?Ct(E>>16&255):H===64?Ct(E>>16&255,E>>8&255):Ct(E>>16&255,E>>8&255,E&255);return X},er=typeof atob=="function"?u=>atob(Mr(u)):Ue?u=>Buffer.from(u,"base64").toString("binary"):Pr,Dr=Ue?u=>kr(Buffer.from(u,"base64")):u=>kr(er(u).split("").map(E=>E.charCodeAt(0))),$r=u=>Dr(zr(u)),Wo=Ue?u=>Buffer.from(u,"base64").toString("utf8"):Er?u=>Er.decode(Dr(u)):u=>Ur(er(u)),zr=u=>Mr(u.replace(/[-_]/g,E=>E=="-"?"+":"/")),Xn=u=>Wo(zr(u)),Go=u=>{if(typeof u!="string")return!1;const E=u.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(E)||!/[^\s0-9a-zA-Z\-_]/.test(E)},Br=u=>({value:u,enumerable:!1,writable:!0,configurable:!0}),Hr=function(){const u=(E,X)=>Object.defineProperty(String.prototype,E,Br(X));u("fromBase64",function(){return Xn(this)}),u("toBase64",function(E){return Re(this,E)}),u("toBase64URI",function(){return Re(this,!0)}),u("toBase64URL",function(){return Re(this,!0)}),u("toUint8Array",function(){return $r(this)})},qr=function(){const u=(E,X)=>Object.defineProperty(Uint8Array.prototype,E,Br(X));u("toBase64",function(E){return Sn(this,E)}),u("toBase64URI",function(){return Sn(this,!0)}),u("toBase64URL",function(){return Sn(this,!0)})},Jo=()=>{Hr(),qr()},Zo={version:Fr,VERSION:Po,atob:er,atobPolyfill:Pr,btoa:tr,btoaPolyfill:Nr,fromBase64:Xn,toBase64:Re,encode:Re,encodeURI:Ir,encodeURL:Ir,utob:Rr,btou:Ur,decode:Xn,isValid:Go,fromUint8Array:Sn,toUint8Array:$r,extendString:Hr,extendUint8Array:qr,extendBuiltins:Jo},Vo=(u,E,X)=>{const et=document.createElement("canvas"),H=et.getContext("2d"),K=new Image;!H||!K||(K.onload=()=>{et.width=K.width*X,et.height=K.height*X,H.drawImage(K,0,0),et.toBlob(D=>{if(D){const d=URL.createObjectURL(D),S=parent.document.getElementById(E);if(!S)throw new Error(`Element '${E}' not found`);S.src=d,S.onload=()=>{URL.revokeObjectURL(d)}}else throw new Error("Unable to create blob")},"image/png")},K.onerror=()=>{throw new Error("Unable to load SVG")},K.src="data:image/svg+xml;base64,"+Zo.encode(u))},Ko=async u=>{const E=await logseq.Editor.getBlock(u,{includeChildren:!0});if(!E)return;const X=E.children;if(!X||X.length==0)return;const[et]=X;if(!et)return;const H=et.content.replace("```mermaid","").replace("```","").replace(`
`," ");if(!(!H||H.length==0))return H},Yo=async()=>{console.log("logseq-mermaid-plugin loaded");const u=logseq.Experiments.ensureHostScope();await logseq.Experiments.loadScripts("../mermaid/mermaid.min.js"),setTimeout(()=>{u.mermaid.initialize({startOnLoad:!1})},100),logseq.Editor.registerSlashCommand("Draw mermaid diagram",async E=>{await logseq.Editor.insertAtEditingCursor(`{{renderer :mermaid_${E.uuid}, 3}}`),await logseq.Editor.insertBlock(E.uuid,"```mermaid\n```",{sibling:!1,before:!1}),logseq.Editor.exitEditingMode(!0)}),logseq.App.onMacroRendererSlotted(async({slot:E,payload:{uuid:X,arguments:et}})=>{const H=`mermaid_${X}_${E}`,[K,D]=et;if(!K||!K.startsWith(":mermaid_"))return;const d=D?parseFloat(D):3;logseq.provideUI({key:H,slot:E,reset:!0,template:`<img id="${H}" />`});const S=await Ko(X);if(!(!S||S.length<2))try{const{svg:T}=await u.mermaid.render("mermaid-diagram",S);setTimeout(async()=>{Vo(T,H,d)},100)}catch(T){throw console.log(T),await logseq.UI.showMsg("Unable to generate mermaid diagram. There may be a typo somewhere.","error"),new Error("Unable to generate mermaid diagram. There may be a typo somewhere.")}})};logseq.ready(Yo).catch(console.error);
